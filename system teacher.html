<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QuestClassAIverse‚Ñ¢ - Math Adventure</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Kanit', sans-serif;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .math-gradient {
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 50%, #fecfef 100%);
        }
        
        .mission-gradient-1 {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
        }
        
        .mission-gradient-2 {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
        }
        
        .mission-gradient-3 {
            background: linear-gradient(135deg, #a8caba 0%, #5d4e75 100%);
        }
        
        .card-hover {
            transition: all 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        .progress-bar {
            background: linear-gradient(90deg, #10b981 0%, #3b82f6 50%, #f59e0b 100%);
            height: 8px;
            border-radius: 4px;
            transition: width 0.5s ease;
        }
        
        .exp-coin {
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .badge-glow {
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
            animation: glow 2s ease-in-out infinite alternate;
        }

        @keyframes glow {
            from { box-shadow: 0 0 20px rgba(255, 215, 0, 0.5); }
            to { box-shadow: 0 0 30px rgba(255, 215, 0, 0.8); }
        }

        .mission-locked {
            filter: grayscale(100%);
            opacity: 0.5;
        }

        .mission-unlocked {
            filter: none;
            opacity: 1;
        }

        .mission-completed {
            border: 3px solid #10b981;
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.3);
        }

        .avatar-male {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .avatar-female {
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
        }
        
        .avatar-teacher {
            background: linear-gradient(135deg, #22d3ee 0%, #0ea5e9 100%);
        }

        .leaderboard-gold { background: linear-gradient(135deg, #ffd700, #ffed4e); }
        .leaderboard-silver { background: linear-gradient(135deg, #c0c0c0, #e8e8e8); }
        .leaderboard-bronze { background: linear-gradient(135deg, #cd7f32, #daa520); }

        .quiz-option {
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .quiz-option:hover {
            background: #f3f4f6;
            transform: translateX(5px);
        }

        .quiz-option.selected {
            background: #ddd6fe;
            border-color: #8b5cf6;
        }
        
        .character-option.selected {
             border-color: #4f46e5;
             box-shadow: 0 0 20px rgba(79, 70, 229, 0.3);
        }

        .quiz-option.correct {
            background: #dcfce7;
            border-color: #16a34a;
        }

        .quiz-option.incorrect {
            background: #fee2e2;
            border-color: #dc2626;
        }
        
        .modal {
            backdrop-filter: blur(10px);
            background: rgba(0, 0, 0, 0.5);
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            padding: 15px 20px;
            border-radius: 10px;
            color: white;
            font-weight: 500;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success { background: #10b981; }
        .notification.error { background: #ef4444; }
        .notification.info { background: #3b82f6; }
        .notification.warning { background: #f59e0b; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">

    <!-- Login Screen -->
    <div id="loginScreen" class="min-h-screen gradient-bg flex items-center justify-center p-6">
        <div class="bg-white/95 backdrop-blur-sm rounded-2xl shadow-2xl p-8 w-full max-w-md">
            <div class="text-center mb-8">
                <div class="text-6xl mb-4">üßÆ</div>
                <h1 class="text-3xl font-bold text-gray-800 mb-2">QuestClassAIverse‚Ñ¢</h1>
                <p class="text-gray-600">‡∏Å‡∏≤‡∏£‡∏ú‡∏à‡∏ç‡∏†‡∏±‡∏¢‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå</p>
                <p class="text-sm text-purple-600 mt-2">üéØ ‡πÄ‡∏•‡∏Ç‡∏¢‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á Adventure</p>
            </div>
            
            <form id="loginForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏´‡∏±‡∏™‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</label>
                    <input type="text" id="username" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‡∏´‡∏£‡∏∑‡∏≠ Teacher" required>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
                    <input type="password" id="password" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" required>
                </div>
                
                <button type="submit" class="w-full gradient-bg text-white py-3 rounded-lg font-semibold hover:opacity-90 transition-opacity">
                    üöÄ ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
                </button>
            </form>

             <div class="mt-4">
                <button class="w-full bg-gray-200 text-gray-500 py-3 rounded-lg font-semibold cursor-not-allowed" title="‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£" disabled>
                    üìù ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å (‡πÄ‡∏£‡πá‡∏ß‡πÜ ‡∏ô‡∏µ‡πâ)
                </button>
            </div>
            
            <div class="mt-6 text-center text-sm text-gray-600 space-y-2">
                <p><strong>‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô:</strong> ‡∏£‡∏´‡∏±‡∏™ ‡∏ô‡∏£. ‡∏à‡∏£‡∏¥‡∏á / ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô <strong>123456</strong> (‡∏´‡∏£‡∏∑‡∏≠ <strong>demo</strong>/<strong>demo</strong>)</p>
                <p><strong>‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏£‡∏π:</strong> ‡∏£‡∏´‡∏±‡∏™ <strong>Teacher</strong> / ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô <strong>admin123</strong></p>
            </div>
        </div>
    </div>

    <!-- Character Selection Screen (For Student) -->
    <div id="characterScreen" class="min-h-screen math-gradient hidden">
        <div class="min-h-screen flex items-center justify-center p-6">
            <div class="bg-white/95 backdrop-blur-sm rounded-2xl shadow-2xl p-8 w-full max-w-2xl">
                <div class="text-center mb-8">
                    <div class="text-6xl mb-4">üé≠</div>
                    <h1 class="text-3xl font-bold text-gray-800 mb-2">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h1>
                    <p class="text-gray-600">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏ß‡∏ï‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ä‡∏∑‡πà‡∏ô‡∏ä‡∏≠‡∏ö</p>
                </div>
                
                <div class="grid md:grid-cols-2 gap-8 mb-8">
                    <div id="char-male" class="character-option text-center p-6 border-2 border-gray-300 rounded-xl cursor-pointer transition-all hover:border-blue-500 hover:shadow-lg" onclick="selectCharacter('male')">
                        <div class="w-32 h-32 mx-auto mb-4 rounded-full avatar-male flex items-center justify-center text-6xl">
                            üë®‚Äçüéì
                        </div>
                        <h3 class="text-xl font-bold text-gray-800">‡∏ô‡∏±‡∏Å‡∏ú‡∏à‡∏ç‡∏†‡∏±‡∏¢‡∏ä‡∏≤‡∏¢</h3>
                        <p class="text-gray-600 mt-2">‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ú‡∏à‡∏ç‡∏†‡∏±‡∏¢‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå</p>
                    </div>
                    
                    <div id="char-female" class="character-option text-center p-6 border-2 border-gray-300 rounded-xl cursor-pointer transition-all hover:border-pink-500 hover:shadow-lg" onclick="selectCharacter('female')">
                        <div class="w-32 h-32 mx-auto mb-4 rounded-full avatar-female flex items-center justify-center text-6xl">
                            üë©‚Äçüéì
                        </div>
                        <h3 class="text-xl font-bold text-gray-800">‡∏ô‡∏±‡∏Å‡∏ú‡∏à‡∏ç‡∏†‡∏±‡∏¢‡∏´‡∏ç‡∏¥‡∏á</h3>
                        <p class="text-gray-600 mt-2">‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ú‡∏à‡∏ç‡∏†‡∏±‡∏¢‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå</p>
                    </div>
                </div>
                
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</label>
                    <input type="text" id="nicknameInput" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" placeholder="‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£" maxlength="20">
                </div>
                
                <button id="confirmCharacter" onclick="confirmCharacterSelection()" class="w-full gradient-bg text-white py-3 rounded-lg font-semibold hover:opacity-90 transition-opacity disabled:opacity-50" disabled>
                    ‚ú® ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ú‡∏à‡∏ç‡∏†‡∏±‡∏¢
                </button>
            </div>
        </div>
    </div>

    <!-- Student Dashboard -->
    <div id="studentDashboard" class="hidden">
        <!-- Header -->
        <div class="gradient-bg text-white py-4">
            <div class="container mx-auto px-6">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                        <div id="playerAvatar" class="w-12 h-12 rounded-full flex items-center justify-center text-2xl">
                            üë®‚Äçüéì
                        </div>
                        <div>
                            <h1 class="text-xl font-bold" id="playerName">‡∏ô‡∏±‡∏Å‡∏ú‡∏à‡∏ç‡∏†‡∏±‡∏¢</h1>
                            <p class="text-xs opacity-80" id="playerClass">Demo Class</p>
                        </div>
                    </div>
                    
                    <div class="flex items-center space-x-4">
                         <div class="text-right">
                            <div class="text-xs opacity-80">Level</div>
                            <div class="text-lg font-bold" id="playerLevel">1</div>
                        </div>
                        <div class="text-right">
                            <div class="text-xs opacity-80">EXP</div>
                            <div class="text-sm font-bold" id="playerExp">0/100</div>
                        </div>
                        <div class="text-right">
                            <div class="text-xs opacity-80">Coins</div>
                            <div class="text-sm font-bold" id="playerCoins">1000</div>
                        </div>
                        <button id="resetDemoDataBtn" onclick="resetDemoData()" class="bg-red-500 hover:bg-red-600 text-white px-3 py-2 rounded-lg transition-colors text-sm hidden">
                            ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                        </button>
                        <button onclick="logout()" class="bg-white/20 hover:bg-white/30 px-3 py-2 rounded-lg transition-colors text-sm">
                            ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Navigation -->
        <div class="bg-white shadow-sm sticky top-0 z-40">
            <div class="container mx-auto px-6">
                <div class="flex overflow-x-auto">
                    <button onclick="showStudentSection('dashboardContent')" id="nav-dashboardContent" class="nav-button student-nav px-6 py-4 font-medium whitespace-nowrap border-b-2 border-purple-500 text-purple-600">
                        üè† ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å
                    </button>
                    <button onclick="showStudentSection('missions')" id="nav-missions" class="nav-button student-nav px-6 py-4 font-medium whitespace-nowrap border-b-2 border-transparent text-gray-600 hover:border-purple-300 hover:text-purple-600">
                        üéØ ‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à
                    </button>
                    <button onclick="showStudentSection('leaderboard')" id="nav-leaderboard" class="nav-button student-nav px-6 py-4 font-medium whitespace-nowrap border-b-2 border-transparent text-gray-600 hover:border-purple-300 hover:text-purple-600">
                        üèÜ ‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô
                    </button>
                    <button onclick="showStudentSection('analysis')" id="nav-analysis" class="nav-button student-nav px-6 py-4 font-medium whitespace-nowrap border-b-2 border-transparent text-gray-600 hover:border-purple-300 hover:text-purple-600">
                        üìä ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ú‡∏•
                    </button>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="container mx-auto px-6 py-8">
            
            <!-- Dashboard Section -->
            <div id="section-dashboardContent" class="student-section-content">
                <!-- Profile & Stats Grid -->
                <div class="grid lg:grid-cols-3 gap-6 mb-6">
                    <!-- Profile Card -->
                    <div class="bg-white rounded-2xl shadow p-6 card-hover">
                        <div class="flex items-center space-x-4">
                            <div id="dashboardAvatar" class="w-20 h-20 rounded-full flex items-center justify-center text-4xl flex-shrink-0">
                                üë®‚Äçüéì
                            </div>
                            <div>
                                <h3 class="text-xl font-bold text-gray-800" id="dashboardName">‡∏ô‡∏±‡∏Å‡∏ú‡∏à‡∏ç‡∏†‡∏±‡∏¢</h3>
                                <p class="text-gray-500" id="dashboardClass">Demo Class</p>
                                <div class="mt-2 space-y-1 text-sm">
                                    <p><strong>Level:</strong> <span id="dashboardLevel">1</span></p>
                                    <p><strong>EXP:</strong> <span class="font-semibold text-yellow-500" id="dashboardExp">0/100</span></p>
                                    <p><strong>Coins:</strong> <span class="font-semibold text-yellow-500" id="dashboardCoins">1000</span></p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Badges -->
                    <div class="bg-white rounded-2xl shadow p-6 card-hover">
                        <h3 class="text-lg font-bold text-gray-800 mb-3">üèÖ ‡∏õ‡πâ‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</h3>
                        <div id="badgesContainer" class="flex justify-around items-center h-full">
                            <div class="text-center opacity-30">
                                <div class="w-16 h-16 mx-auto bg-gray-200 rounded-full flex items-center justify-center text-3xl mb-1">üß©</div>
                                <p class="text-xs text-gray-500">Maze Master</p>
                            </div>
                            <div class="text-center opacity-30">
                                <div class="w-16 h-16 mx-auto bg-gray-200 rounded-full flex items-center justify-center text-3xl mb-1">üçÑ</div>
                                <p class="text-xs text-gray-500">Power Collector</p>
                            </div>
                            <div class="text-center opacity-30">
                                <div class="w-16 h-16 mx-auto bg-gray-200 rounded-full flex items-center justify-center text-3xl mb-1">üåâ</div>
                                <p class="text-xs text-gray-500">Science Explorer</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Quick Stats -->
                    <div class="bg-white rounded-2xl shadow p-6 card-hover">
                         <h3 class="text-lg font-bold text-gray-800 mb-3">üìà ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏î‡πà‡∏ß‡∏ô</h3>
                         <div class="space-y-2 text-sm">
                            <div class="flex justify-between items-center">
                                <span class="text-gray-600">‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô:</span>
                                <span class="font-bold text-green-600 text-base" id="completedMissions">0/3</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-gray-600">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°:</span>
                                <span class="font-bold text-blue-600 text-base" id="totalScore">0</span>
                            </div>
                             <div class="flex justify-between items-center">
                                <span class="text-gray-600">‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏•‡πà‡∏ô‡∏£‡∏ß‡∏°:</span>
                                <span class="font-bold text-purple-600 text-base" id="totalPlayTime">0 ‡∏ô‡∏≤‡∏ó‡∏µ</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-gray-600">‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥:</span>
                                <span class="font-bold text-orange-600 text-base" id="accuracy">0%</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Mission Progress -->
                <div class="bg-white rounded-2xl shadow p-6 mb-6">
                    <div class="flex justify-between items-center mb-4">
                         <h3 class="text-xl font-bold text-gray-800">üéØ ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à</h3>
                         <button class="bg-yellow-100 text-yellow-700 text-sm font-semibold px-3 py-1 rounded-lg">‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô‡πÅ‡∏ö‡∏ö‡πÄ‡∏ö‡∏¥‡πâ‡∏°‡πÜ</button>
                    </div>
                    <div class="grid md:grid-cols-3 gap-6">
                        <!-- Mission Cards updated style -->
                        <div id="mission1Card" class="bg-gray-100 rounded-xl p-4 text-center">
                            <div class="text-4xl mb-2 opacity-50">üß©</div>
                            <h4 class="text-lg font-bold text-gray-700">Maze Quest</h4>
                            <p class="text-sm text-gray-500 mb-3">‡πÄ‡∏Ç‡∏≤‡∏ß‡∏á‡∏Å‡∏ï‡πÅ‡∏´‡πà‡∏á‡πÄ‡∏•‡∏Ç‡∏¢‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á</p>
                            <button id="mission1Btn" class="w-full bg-gray-300 text-gray-600 py-2 rounded-lg font-semibold text-sm cursor-not-allowed" disabled>üîí ‡∏ó‡∏≥ Pre-test ‡∏Å‡πà‡∏≠‡∏ô</button>
                        </div>
                        <div id="mission2Card" class="bg-gray-100 rounded-xl p-4 text-center">
                            <div class="text-4xl mb-2 opacity-50">üçÑ</div>
                            <h4 class="text-lg font-bold text-gray-700">Power Collector</h4>
                            <p class="text-sm text-gray-500 mb-3">‡∏ô‡∏±‡∏Å‡∏™‡∏∞‡∏™‡∏°‡∏û‡∏•‡∏±‡∏á‡πÅ‡∏´‡πà‡∏á‡∏õ‡πà‡∏≤</p>
                            <button id="mission2Btn" class="w-full bg-gray-300 text-gray-600 py-2 rounded-lg font-semibold text-sm cursor-not-allowed" disabled>üîí ‡∏ú‡πà‡∏≤‡∏ô‡∏î‡πà‡∏≤‡∏ô 1 ‡∏Å‡πà‡∏≠‡∏ô</button>
                        </div>
                         <div id="mission3Card" class="bg-gray-100 rounded-xl p-4 text-center">
                            <div class="text-4xl mb-2 opacity-50">üåâ</div>
                            <h4 class="text-lg font-bold text-gray-700">Science Bridge</h4>
                            <p class="text-sm text-gray-500 mb-3">‡∏™‡∏∞‡∏û‡∏≤‡∏ô‡πÅ‡∏´‡πà‡∏á‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå</p>
                            <button id="mission3Btn" class="w-full bg-gray-300 text-gray-600 py-2 rounded-lg font-semibold text-sm cursor-not-allowed" disabled>üîí ‡∏ú‡πà‡∏≤‡∏ô‡∏î‡πà‡∏≤‡∏ô 2 ‡∏Å‡πà‡∏≠‡∏ô</button>
                        </div>
                    </div>
                </div>

                <!-- Test Status -->
                <div class="grid md:grid-cols-2 gap-6">
                    <!-- Pre-Test -->
                    <div id="preTestCard" class="bg-white rounded-2xl shadow p-6 card-hover text-center">
                        <div class="text-5xl mb-3">üìã</div>
                        <h3 class="text-xl font-bold text-gray-800 mb-2">‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h3>
                        <div id="preTestContent">
                            <p class="text-gray-600 mb-4">‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô</p>
                            <button onclick="startTest('pre')" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg font-semibold transition-colors">
                                üöÄ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö
                            </button>
                        </div>
                    </div>
                    
                    <!-- Post-Test -->
                    <div id="postTestCard" class="bg-white rounded-2xl shadow p-6 card-hover text-center">
                        <div class="text-5xl mb-3 opacity-30">üìä</div>
                        <h3 class="text-xl font-bold text-gray-800 mb-2">‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h3>
                        <div id="postTestContent">
                            <p class="text-gray-500 mb-4">‡∏ú‡πà‡∏≤‡∏ô‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏ó‡∏±‡πâ‡∏á 3 ‡∏î‡πà‡∏≤‡∏ô‡∏Å‡πà‡∏≠‡∏ô</p>
                            <button id="postTestBtn" onclick="startTest('post')" class="bg-gray-300 text-gray-500 px-6 py-2 rounded-lg font-semibold cursor-not-allowed" disabled>
                                üîí ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Missions Section -->
            <div id="section-missions" class="student-section-content hidden">
                <div class="text-center mb-8">
                    <h2 class="text-3xl font-bold text-gray-800 mb-4">üéØ ‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏Å‡∏≤‡∏£‡∏ú‡∏à‡∏ç‡∏†‡∏±‡∏¢</h2>
                    <p class="text-gray-600">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡πâ‡∏≤‡∏ó‡∏≤‡∏¢</p>
                </div>
                
                <div class="grid md:grid-cols-3 gap-8">
                    <!-- Mission 1 Detail -->
                    <div class="bg-white rounded-2xl shadow-lg overflow-hidden card-hover">
                        <div class="mission-gradient-1 p-6 text-center">
                            <div class="text-6xl mb-4">üß©</div>
                            <h3 class="text-2xl font-bold text-gray-800">Maze Quest</h3>
                            <p class="text-gray-600 mt-2">‡πÄ‡∏Ç‡∏≤‡∏ß‡∏á‡∏Å‡∏ï‡πÅ‡∏´‡πà‡∏á‡πÄ‡∏•‡∏Ç‡∏¢‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á</p>
                        </div>
                        <div class="p-6">
                            <div class="space-y-3 mb-6">
                                <div class="flex items-center space-x-2">
                                    <span class="text-green-500">‚úì</span>
                                    <span class="text-sm">‡∏ô‡∏¥‡∏¢‡∏≤‡∏°‡πÄ‡∏•‡∏Ç‡∏¢‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á</span>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <span class="text-green-500">‚úì</span>
                                    <span class="text-sm">‡∏≠‡∏á‡∏Ñ‡πå‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á‡πÄ‡∏•‡∏Ç‡∏¢‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á</span>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <span class="text-green-500">‚úì</span>
                                    <span class="text-sm">‡∏Å‡∏≤‡∏£‡∏´‡∏≤‡∏Ñ‡πà‡∏≤‡πÄ‡∏•‡∏Ç‡∏¢‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á</span>
                                </div>
                            </div>
                            <div class="text-center">
                                <div class="text-sm text-gray-600 mb-2">‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î</div>
                                <div class="text-lg font-bold text-blue-600 mb-4" id="mission1TimeLimit">-- ‡∏ô‡∏≤‡∏ó‡∏µ</div>
                                <button onclick="startMission(1)" class="w-full bg-purple-600 hover:bg-purple-700 text-white py-2 rounded-lg font-semibold transition-colors">
                                    üöÄ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à
                                </button>
                            </div>
                        </div>
                    </div>
                     <!-- Mission 2 Detail -->
                    <div class="bg-white rounded-2xl shadow-lg overflow-hidden card-hover">
                        <div class="mission-gradient-2 p-6 text-center">
                            <div class="text-6xl mb-4">üçÑ</div>
                            <h3 class="text-2xl font-bold text-gray-800">Power Collector</h3>
                            <p class="text-gray-600 mt-2">‡∏ô‡∏±‡∏Å‡∏™‡∏∞‡∏™‡∏°‡∏û‡∏•‡∏±‡∏á‡πÅ‡∏´‡πà‡∏á‡∏õ‡πà‡∏≤</p>
                        </div>
                        <div class="p-6">
                            <div class="space-y-3 mb-6">
                                <div class="flex items-center space-x-2">
                                    <span class="text-green-500">‚úì</span>
                                    <span class="text-sm">‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ñ‡∏π‡∏ì‡πÅ‡∏•‡∏∞‡∏´‡∏≤‡∏£</span>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <span class="text-green-500">‚úì</span>
                                    <span class="text-sm">‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥‡πÄ‡∏•‡∏Ç‡∏¢‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ã‡πâ‡∏≠‡∏ô</span>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <span class="text-green-500">‚úì</span>
                                    <span class="text-sm">‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥‡πÄ‡∏•‡∏Ç‡∏¢‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á 0 ‡πÅ‡∏•‡∏∞ 1</span>
                                </div>
                            </div>
                            <div class="text-center">
                                <div class="text-sm text-gray-600 mb-2">‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î</div>
                                <div class="text-lg font-bold text-blue-600 mb-4" id="mission2TimeLimit">-- ‡∏ô‡∏≤‡∏ó‡∏µ</div>
                                <button onclick="startMission(2)" class="w-full bg-purple-600 hover:bg-purple-700 text-white py-2 rounded-lg font-semibold transition-colors">
                                    üöÄ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à
                                </button>
                            </div>
                        </div>
                    </div>
                     <!-- Mission 3 Detail -->
                    <div class="bg-white rounded-2xl shadow-lg overflow-hidden card-hover">
                        <div class="mission-gradient-3 p-6 text-center">
                            <div class="text-6xl mb-4">üåâ</div>
                            <h3 class="text-2xl font-bold text-white">Science Bridge</h3>
                            <p class="text-gray-200 mt-2">‡∏™‡∏∞‡∏û‡∏≤‡∏ô‡πÅ‡∏´‡πà‡∏á‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå</p>
                        </div>
                        <div class="p-6">
                            <div class="space-y-3 mb-6">
                                <div class="flex items-center space-x-2">
                                    <span class="text-green-500">‚úì</span>
                                    <span class="text-sm">‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏™‡∏±‡∏ç‡∏Å‡∏£‡∏ì‡πå‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå</span>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <span class="text-green-500">‚úì</span>
                                    <span class="text-sm">‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö</span>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <span class="text-green-500">‚úì</span>
                                    <span class="text-sm">‡∏Å‡∏≤‡∏£‡∏ö‡∏ß‡∏Å ‡∏•‡∏ö ‡∏Ñ‡∏π‡∏ì ‡∏´‡∏≤‡∏£</span>
                                </div>
                            </div>
                            <div class="text-center">
                                <div class="text-sm text-gray-600 mb-2">‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î</div>
                                <div class="text-lg font-bold text-blue-600 mb-4" id="mission3TimeLimit">-- ‡∏ô‡∏≤‡∏ó‡∏µ</div>
                                <button onclick="startMission(3)" class="w-full bg-purple-600 hover:bg-purple-700 text-white py-2 rounded-lg font-semibold transition-colors">
                                    üöÄ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Leaderboard Section -->
            <div id="section-leaderboard" class="student-section-content hidden">
                <div class="text-center mb-8">
                    <h2 class="text-3xl font-bold text-gray-800 mb-4">üèÜ ‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</h2>
                    <p class="text-gray-600">‡∏î‡∏π‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                </div>
                <div class="bg-white rounded-2xl shadow-lg p-6 max-w-4xl mx-auto">
                    <div id="studentLeaderboardContainer" class="space-y-4">
                        <!-- Leaderboard rows will be injected here -->
                    </div>
                </div>
            </div>

            <!-- Analysis Section -->
            <div id="section-analysis" class="student-section-content hidden">
                 <div class="text-center mb-8">
                    <h2 class="text-3xl font-bold text-gray-800 mb-4">üìä ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ</h2>
                    <p class="text-gray-600">‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡πâ‡∏≤‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏û‡∏±‡∏í‡∏ô‡∏≤</p>
                </div>
                <div class="bg-white rounded-2xl shadow-lg p-6">
                    <div class="grid md:grid-cols-2 gap-8">
                        <div>
                             <h3 class="text-xl font-bold text-gray-800 mb-4">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô Pre-test vs Post-test</h3>
                             <canvas id="studentTestScoresChart"></canvas>
                        </div>
                        <div>
                            <h3 class="text-xl font-bold text-gray-800 mb-4">‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥‡∏ï‡∏≤‡∏°‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠</h3>
                            <canvas id="studentAccuracyByTopicChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
    
    <!-- Teacher Dashboard -->
    <div id="teacherDashboard" class="hidden">
         <!-- Header -->
        <div class="gradient-bg text-white py-4">
            <div class="container mx-auto px-6 flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <div class="w-12 h-12 rounded-full flex items-center justify-center text-2xl avatar-teacher">
                        üë®‚Äçüè´
                    </div>
                    <div>
                        <h1 class="text-xl font-bold">‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏£‡∏π</h1>
                        <p class="text-xs opacity-80">‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô MTTMONGKOL</p>
                    </div>
                </div>
                <button onclick="logout()" class="bg-white/20 hover:bg-white/30 px-3 py-2 rounded-lg transition-colors text-sm">
                    ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
                </button>
            </div>
        </div>
        <!-- Navigation -->
        <div class="bg-white shadow-sm sticky top-0 z-40">
            <div class="container mx-auto px-6">
                <div class="flex overflow-x-auto">
                    <button onclick="showTeacherSection('conclusion')" id="nav-conclusion" class="nav-button teacher-nav px-6 py-4 font-medium whitespace-nowrap border-b-2 border-purple-500 text-purple-600">
                        ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°
                    </button>
                    <button onclick="showTeacherSection('analytics')" id="nav-analytics" class="nav-button teacher-nav px-6 py-4 font-medium whitespace-nowrap border-b-2 border-transparent text-gray-600 hover:border-purple-300 hover:text-purple-600">
                        ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
                    </button>
                    <button onclick="showTeacherSection('teacherLeaderboard')" id="nav-teacherLeaderboard" class="nav-button teacher-nav px-6 py-4 font-medium whitespace-nowrap border-b-2 border-transparent text-gray-600 hover:border-purple-300 hover:text-purple-600">
                        ‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô
                    </button>
                    <button onclick="showTeacherSection('management')" id="nav-management" class="nav-button teacher-nav px-6 py-4 font-medium whitespace-nowrap border-b-2 border-transparent text-gray-600 hover:border-purple-300 hover:text-purple-600">
                        ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
                    </button>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="container mx-auto px-6 py-8">
            <!-- Conclusion Section -->
            <div id="section-conclusion" class="teacher-section-content">
                 <div class="flex justify-between items-center mb-6">
                    <h2 class="text-3xl font-bold text-gray-800">‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°</h2>
                    <button onclick="loadTeacherData()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg font-semibold flex items-center space-x-2">
                        <span>üîÑ</span>
                        <span>‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</span>
                    </button>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white p-6 rounded-2xl shadow-lg flex items-center space-x-4">
                        <div class="bg-blue-100 text-blue-600 p-4 rounded-full text-2xl">üë•</div>
                        <div>
                            <p class="text-gray-500">‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                            <p class="text-2xl font-bold" id="teacherTotalStudents">0</p>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow-lg flex items-center space-x-4">
                        <div class="bg-green-100 text-green-600 p-4 rounded-full text-2xl">üìà</div>
                         <div>
                            <p class="text-gray-500">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢</p>
                            <p class="text-2xl font-bold" id="teacherAvgScore">0%</p>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow-lg flex items-center space-x-4">
                        <div class="bg-yellow-100 text-yellow-600 p-4 rounded-full text-2xl">üéØ</div>
                         <div>
                            <p class="text-gray-500">‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏ó‡∏µ‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</p>
                            <p class="text-2xl font-bold" id="teacherMissionCompletion">0%</p>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow-lg flex items-center space-x-4">
                        <div class="bg-purple-100 text-purple-600 p-4 rounded-full text-2xl">üí°</div>
                         <div>
                            <p class="text-gray-500">‡∏Ñ‡πà‡∏≤ DS ‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢</p>
                            <p class="text-2xl font-bold" id="teacherAvgDs">+0.00%</p>
                        </div>
                    </div>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-5 gap-8">
                    <div class="lg:col-span-3 bg-white rounded-2xl shadow-lg p-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h3>
                        <canvas id="teacherStudentScoresChart"></canvas>
                    </div>
                    <div class="lg:col-span-2 bg-white rounded-2xl shadow-lg p-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏î‡∏π‡πÅ‡∏•‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©</h3>
                        <ul id="studentsToHelpList" class="space-y-3">
                           <!-- Students needing help will be populated here -->
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Student Analytics Section -->
            <div id="section-analytics" class="teacher-section-content hidden">
                <div class="bg-white rounded-2xl shadow-lg p-6">
                    <div class="flex flex-col md:flex-row justify-between items-center mb-4 gap-4">
                        <h2 class="text-2xl font-bold">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h2>
                        <div class="flex items-center gap-4 w-full md:w-auto">
                           <input type="text" id="studentSearch" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô..." class="w-full md:w-64 p-2 border rounded-lg">
                           <button class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg whitespace-nowrap">Export CSV</button>
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead>
                                <tr class="bg-gray-100">
                                    <th class="p-3">‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•</th>
                                    <th class="p-3">‡∏ä‡∏±‡πâ‡∏ô</th>
                                    <th class="p-3">Level</th>
                                    <th class="p-3">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô Pre-test</th>
                                    <th class="p-3">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô Post-test</th>
                                    <th class="p-3">DS</th>
                                </tr>
                            </thead>
                            <tbody id="studentAnalyticsTable">
                                <!-- Student data will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Teacher Leaderboard Section -->
            <div id="section-teacherLeaderboard" class="teacher-section-content hidden">
                 <div class="bg-white rounded-2xl shadow-lg p-6 max-w-4xl mx-auto">
                    <h2 class="text-2xl font-bold text-center mb-4">‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°</h2>
                    <div id="teacherLeaderboardContainer" class="space-y-4">
                        <!-- Leaderboard rows will be injected here -->
                    </div>
                </div>
            </div>
            
             <!-- Classroom Management Section -->
            <div id="section-management" class="teacher-section-content hidden">
                 <div class="flex justify-between items-center mb-6">
                    <h2 class="text-3xl font-bold text-gray-800">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h2>
                    <button onclick="openCreateClassModal()" class="bg-purple-600 hover:bg-purple-700 text-white px-5 py-2 rounded-lg font-semibold flex items-center space-x-2">
                        <span>+</span>
                        <span>‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÉ‡∏´‡∏°‡πà</span>
                    </button>
                </div>
                <div id="classListContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Class cards will be populated here -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modals & Notifications -->
    <div id="notification-container"></div>
    
    <!-- Test/Mission Modal -->
    <div id="quizModal" class="fixed inset-0 z-[100] modal items-center justify-center hidden">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col">
            <div class="p-4 border-b flex justify-between items-center">
                <h2 id="quizTitle" class="text-2xl font-bold">‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö</h2>
                 <div id="quizProgress" class="text-lg font-semibold text-gray-600">‡∏Ç‡πâ‡∏≠ 1 / 10</div>
                <button onclick="closeQuiz()" class="text-gray-500 hover:text-gray-800 text-3xl">&times;</button>
            </div>
            <div id="quizContent" class="p-8 overflow-y-auto">
                <!-- Quiz content will be injected here -->
            </div>
             <div id="aiHintContainer" class="p-4 bg-purple-50 border-t hidden">
                <p class="text-sm text-purple-800 text-center" id="aiHintText">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ç‡∏≠‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ‡∏à‡∏≤‡∏Å AI...</p>
             </div>
             <div class="p-4 border-t flex justify-end items-center gap-4">
                <button id="aiHintButton" onclick="getAIHint()" class="bg-purple-100 text-purple-700 px-4 py-2 rounded-lg font-semibold hidden">‚ú® ‡∏Ç‡∏≠‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ‡∏à‡∏≤‡∏Å AI</button>
                <button id="nextQuestionBtn" onclick="nextQuestion()" class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-2 rounded-lg">‡∏Ç‡πâ‡∏≠‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</button>
            </div>
        </div>
    </div>
    
    <!-- Mission Failed Modal -->
    <div id="missionFailedModal" class="fixed inset-0 z-[100] modal items-center justify-center hidden">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-lg text-center p-8">
            <div class="text-6xl mb-4">üò≠</div>
            <h2 class="text-2xl font-bold text-red-600 mb-4">‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</h2>
            <p class="text-gray-600 mb-6" id="failReasonText">‡∏î‡∏π‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏ß‡πà‡∏≤‡πÄ‡∏ß‡∏•‡∏≤‡∏à‡∏∞‡∏´‡∏°‡∏î‡∏•‡∏á‡∏ã‡∏∞‡∏Å‡πà‡∏≠‡∏ô ‡∏•‡∏≠‡∏á‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ô‡∏∞!</p>
            <div id="youtubeLinkContainer">
                <a href="#" target="_blank" class="bg-red-500 hover:bg-red-600 text-white font-semibold px-6 py-3 rounded-lg inline-block">
                    üì∫ ‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
                </a>
            </div>
            <button onclick="closeMissionFailedModal()" class="mt-4 text-gray-500 hover:text-gray-700">‡∏õ‡∏¥‡∏î</button>
        </div>
    </div>


    <!-- Create Class Modal -->
    <div id="createClassModal" class="fixed inset-0 z-[100] modal items-center justify-center hidden">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-lg">
            <form id="createClassForm">
                <div class="p-6 border-b">
                    <h2 class="text-2xl font-bold text-gray-800">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÉ‡∏´‡∏°‡πà</h2>
                </div>
                <div class="p-6 space-y-4">
                     <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label>
                        <input type="text" id="newClassName" class="w-full px-3 py-2 border border-gray-300 rounded-lg" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏°.1/1 ‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤</label>
                        <input type="text" id="newClassSubject" class="w-full px-3 py-2 border border-gray-300 rounded-lg" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô" required>
                    </div>
                     <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏™‡∏±‡πâ‡∏ô‡πÜ</label>
                        <textarea id="newClassDescription" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg" placeholder="‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ô‡∏µ‡πâ..."></textarea>
                    </div>
                </div>
                <div class="p-4 bg-gray-50 rounded-b-2xl flex justify-end space-x-3">
                    <button type="button" onclick="closeCreateClassModal()" class="bg-gray-200 hover:bg-gray-300 text-gray-800 px-4 py-2 rounded-lg">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    <button type="submit" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Student Detail Modal -->
    <div id="studentDetailModal" class="fixed inset-0 z-[100] modal items-center justify-center hidden">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-lg">
            <div class="p-6 border-b flex justify-between items-center">
                <h2 class="text-2xl font-bold text-gray-800">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h2>
                <button onclick="closeStudentDetailModal()" class="text-gray-500 hover:text-gray-800 text-3xl">&times;</button>
            </div>
            <div id="studentDetailContent" class="p-6 space-y-4">
                <!-- Details will be injected here -->
                <p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>
            </div>
             <div class="p-4 bg-gray-50 rounded-b-2xl flex justify-end">
                <button onclick="closeStudentDetailModal()" class="bg-gray-200 hover:bg-gray-300 text-gray-800 px-4 py-2 rounded-lg">‡∏õ‡∏¥‡∏î</button>
            </div>
        </div>
    </div>

    <script>
        // --- Gemini API Configuration ---
        const API_KEY = ""; // Leave this as an empty string.
        const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${API_KEY}`;
        
        // --- Embedded Real Data ---
        const DB_MEMBERS = [{"member_id":"0-2","full_name":"demo ","nickname":"demo","email":"demo@example.com","password_hash":"demo","class":"T-STAFF","student_id":"T001","role":"admin"},{"member_id":"1","full_name":"‡∏®‡∏®‡∏¥‡∏ò‡∏£ ‡∏ä‡∏≤‡∏ç‡∏Å‡∏¥‡∏à","nickname":"‡πÄ‡∏Å‡∏°‡∏™‡πå","email":"m201001@school.ac.th","password_hash":"123456","class":"‡∏°.2/1","student_id":"M201001","role":"student"},{"member_id":"2","full_name":"‡∏û‡∏®‡∏¥‡∏ô ‡∏ß‡∏£‡πÄ‡∏ß‡∏ä","nickname":"‡∏≠‡∏≤‡∏£‡πå‡∏ï","email":"m201002@school.ac.th","password_hash":"123456","class":"‡∏°.2/1","student_id":"M201002","role":"student"},{"member_id":"3","full_name":"‡∏ì‡∏±‡∏ê‡∏î‡∏ô‡∏±‡∏¢ ‡∏Å‡∏∏‡∏•‡∏ô‡∏≤‡∏ñ","nickname":"‡∏ö‡∏¥‡πä‡∏Å‡∏Å‡∏µ‡πâ","email":"m201003@school.ac.th","password_hash":"123456","class":"‡∏°.2/1","student_id":"M201003","role":"student"},{"member_id":"4","full_name":"‡∏õ‡∏≤‡∏ì‡∏¥‡∏™‡∏£‡∏≤ ‡∏û‡∏á‡∏®‡πå‡∏û‡∏¥‡∏û‡∏±‡∏í‡∏ô‡πå","nickname":"‡∏¢‡∏π‡∏Å‡∏¥","email":"m201004@school.ac.th","password_hash":"123456","class":"‡∏°.2/1","student_id":"M201004","role":"student"},{"member_id":"5","full_name":"‡∏Å‡∏°‡∏•‡∏ß‡∏£‡∏£‡∏ì ‡∏ß‡∏£‡∏≤‡∏Å‡∏£","nickname":"‡πÄ‡∏Å‡∏°‡∏™‡πå","email":"m201005@school.ac.th","password_hash":"123456","class":"‡∏°.2/1","student_id":"M201005","role":"student"},{"member_id":"6","full_name":"‡∏õ‡∏Å‡∏£‡∏ì‡πå ‡πÄ‡∏ó‡∏ß‡∏§‡∏ó‡∏ò‡∏¥‡πå","nickname":"‡∏Å‡∏±‡∏ô","email":"m201006@school.ac.th","password_hash":"123456","class":"‡∏°.2/1","student_id":"M201006","role":"student"},{"member_id":"7","full_name":"‡∏ì‡∏±‡∏ê‡∏ä‡∏ô‡∏¥‡∏©‡∏≤ ‡∏ß‡∏¥‡πÄ‡∏®‡∏©‡∏™‡∏¥‡∏ô","nickname":"‡πÄ‡∏Å‡∏°‡∏™‡πå","email":"m201007@school.ac.th","password_hash":"123456","class":"‡∏°.2/1","student_id":"M201007","role":"student"},{"member_id":"8","full_name":"‡∏ç‡∏≤‡∏î‡∏≤ ‡∏ß‡∏±‡∏í‡∏ô‡∏≤","nickname":"‡∏à‡∏π‡∏ô","email":"m201008@school.ac.th","password_hash":"123456","class":"‡∏°.2/1","student_id":"M201008","role":"student"},{"member_id":"9","full_name":"‡∏õ‡∏∏‡∏ì‡∏¢‡∏≤‡∏û‡∏£ ‡∏ä‡∏π‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥","nickname":"‡∏ß‡∏¥‡∏ß","email":"m201009@school.ac.th","password_hash":"123456","class":"‡∏°.2/1","student_id":"M201009","role":"student"},{"member_id":"10","full_name":"‡∏Å‡∏§‡∏ï‡∏¥‡∏ô ‡πÑ‡∏ä‡∏¢‡∏¢‡∏®","nickname":"‡∏¢‡∏π‡∏Å‡∏¥","email":"m201010@school.ac.th","password_hash":"123456","class":"‡∏°.2/1","student_id":"M201010","role":"student"},{"member_id":"11","full_name":"‡∏û‡∏®‡∏¥‡∏ô ‡∏®‡∏£‡∏µ‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏¥‡πå","nickname":"‡πÑ‡∏≠‡∏ã‡πå","email":"m201011@school.ac.th","password_hash":"123456","class":"‡∏°.2/1","student_id":"M201011","role":"student"},{"member_id":"12","full_name":"‡∏õ‡∏∏‡∏ì‡∏¢‡∏≤‡∏û‡∏£ ‡πÄ‡∏£‡∏∑‡∏≠‡∏á‡πÄ‡∏î‡∏ä","nickname":"‡∏Å‡∏≤‡∏ô‡∏ï‡πå","email":"m201012@school.ac.th","password_hash":"123456","class":"‡∏°.2/1","student_id":"M201012","role":"student"},{"member_id":"13","full_name":"‡∏û‡∏®‡∏¥‡∏ô ‡∏™‡∏¥‡∏£‡∏¥‡∏Å‡∏∏‡∏•","nickname":"‡∏õ‡πä‡∏≠‡∏õ","email":"m201013@school.ac.th","password_hash":"123456","class":"‡∏°.2/1","student_id":"M201013","role":"student"},{"member_id":"14","full_name":"‡∏≠‡∏±‡∏ç‡∏ä‡∏¥‡∏™‡∏≤ ‡∏Å‡∏∏‡∏•‡∏ô‡∏≤‡∏ñ","nickname":"‡∏ù‡∏ô","email":"m201014@school.ac.th","password_hash":"123456","class":"‡∏°.2/1","student_id":"M201014","role":"student"},{"member_id":"15","full_name":"‡∏™‡∏∏‡∏û‡∏¥‡∏ä‡∏ä‡∏≤ ‡∏Å‡∏¥‡∏ï‡∏ï‡∏¥‡∏Ñ‡∏∏‡∏ì","nickname":"‡πÅ‡∏û‡∏ô","email":"m201015@school.ac.th","password_hash":"123456","class":"‡∏°.2/1","student_id":"M201015","role":"student"},{"member_id":"16","full_name":"‡∏ì‡∏±‡∏ê‡∏ä‡∏¢‡∏≤ ‡∏ß‡∏¥‡πÄ‡∏®‡∏©‡∏™‡∏¥‡∏ô","nickname":"‡∏Ñ‡∏¥‡∏ß","email":"m201016@school.ac.th","password_hash":"123456","class":"‡∏°.2/1","student_id":"M201016","role":"student"},{"member_id":"17","full_name":"‡∏ß‡∏ä‡∏¥‡∏£‡∏ß‡∏¥‡∏ä‡∏ç‡πå ‡∏ä‡∏≤‡∏ç‡∏ß‡∏∏‡∏í‡∏¥","nickname":"‡∏£‡∏¥‡∏ß","email":"m201017@school.ac.th","password_hash":"123456","class":"‡∏°.2/1","student_id":"M201017","role":"student"},{"member_id":"18","full_name":"‡∏≠‡∏±‡∏Ñ‡∏£‡πÄ‡∏î‡∏ä ‡∏à‡∏¥‡∏£‡∏†‡∏±‡∏ó‡∏£","nickname":"‡∏°‡∏≤‡∏¢‡∏î‡πå","email":"m201018@school.ac.th","password_hash":"123456","class":"‡∏°.2/1","student_id":"M201018","role":"student"},{"member_id":"19","full_name":"‡∏Ç‡∏ß‡∏±‡∏ç‡∏ä‡∏ô‡∏Å ‡∏≠‡∏†‡∏¥‡∏ß‡∏±‡∏í‡∏ô‡πå","nickname":"‡πÇ‡∏¢","email":"m201019@school.ac.th","password_hash":"123456","class":"‡∏°.2/1","student_id":"M201019","role":"student"},{"member_id":"20","full_name":"‡∏ä‡∏ç‡∏≤‡∏ô‡∏¥‡∏® ‡πÄ‡∏û‡πá‡∏ç‡∏®‡∏£‡∏µ","nickname":"‡πÄ‡∏ô‡∏¢","email":"m201020@school.ac.th","password_hash":"123456","class":"‡∏°.2/1","student_id":"M201020","role":"student"},{"member_id":"21","full_name":"‡∏õ‡∏∏‡∏ì‡∏ì‡∏ß‡∏¥‡∏ä ‡∏°‡∏ô‡∏ï‡∏£‡∏µ","nickname":"‡πÑ‡∏ï‡∏ï‡∏±‡πâ‡∏ô","email":"m201021@school.ac.th","password_hash":"123456","class":"‡∏°.2/1","student_id":"M201021","role":"student"},{"member_id":"22","full_name":"‡∏à‡∏¥‡∏£‡∏±‡∏ä‡∏ç‡∏≤ ‡∏™‡∏≤‡∏£‡∏∞‡∏û‡∏á‡∏©‡πå","nickname":"‡∏ï‡∏±‡∏á‡∏Ñ‡πå","email":"m201022@school.ac.th","password_hash":"123456","class":"‡∏°.2/1","student_id":"M201022","role":"student"},{"member_id":"23","full_name":"‡∏û‡∏ä‡∏£ ‡∏™‡∏≤‡∏£‡∏∞‡∏û‡∏á‡∏©‡πå","nickname":"‡πÉ‡∏ö‡πÄ‡∏ü‡∏¥‡∏£‡πå‡∏ô","email":"m201023@school.ac.th","password_hash":"123456","class":"‡∏°.2/1","student_id":"M201023","role":"student"},{"member_id":"24","full_name":"‡∏™‡∏∏‡∏û‡∏¥‡∏ä‡∏ä‡∏≤ ‡∏à‡∏≤‡∏£‡∏∏‡∏ß‡∏±‡∏í‡∏ô‡πå","nickname":"‡∏ô‡πâ‡∏≥‡∏Ñ‡πâ‡∏≤‡∏á","email":"m201024@school.ac.th","password_hash":"123456","class":"‡∏°.2/1","student_id":"M201024","role":"student"},{"member_id":"25","full_name":"‡∏®‡∏®‡∏¥‡∏ò‡∏£ ‡πÄ‡∏û‡πá‡∏ç‡∏®‡∏£‡∏µ","nickname":"‡πÑ‡∏≠‡∏ã‡πå","email":"m201025@school.ac.th","password_hash":"123456","class":"‡∏°.2/1","student_id":"M201025","role":"student"},{"member_id":"26","full_name":"‡∏ß‡∏£‡∏¥‡∏®‡∏£‡∏≤ ‡∏ß‡∏±‡∏í‡∏ô‡∏∞‡∏ä‡∏±‡∏¢","nickname":"‡πÅ‡∏ö‡∏°","email":"m201026@school.ac.th","password_hash":"123456","class":"‡∏°.2/1","student_id":"M201026","role":"student"},{"member_id":"27","full_name":"‡∏®‡∏∏‡∏†‡∏¥‡∏Å‡∏≤ ‡∏ô‡∏†‡∏≤‡∏û‡∏£","nickname":"‡∏ú‡∏¥‡∏á","email":"m201027@school.ac.th","password_hash":"123456","class":"‡∏°.2/1","student_id":"M201027","role":"student"},{"member_id":"28","full_name":"‡∏ê‡∏≤‡∏õ‡∏ô‡∏µ‡∏¢‡πå ‡∏ò‡∏µ‡∏£‡∏®‡∏±‡∏Å‡∏î‡∏¥‡πå","nickname":"‡∏û‡∏µ‡∏Ñ","email":"m201028@school.ac.th","password_hash":"123456","class":"‡∏°.2/1","student_id":"M201028","role":"student"},{"member_id":"29","full_name":"‡πÄ‡∏°‡∏ò‡∏≤‡∏ß‡∏µ ‡∏®‡∏∏‡∏†‡∏°‡∏¥‡∏ï‡∏£","nickname":"‡∏ô‡πâ‡∏≥‡∏´‡∏ß‡∏≤‡∏ô","email":"m201029@school.ac.th","password_hash":"123456","class":"‡∏°.2/1","student_id":"M201029","role":"student"},{"member_id":"30","full_name":"‡∏û‡∏¥‡∏ä‡∏ç‡∏≤‡∏†‡∏≤ ‡∏ß‡∏£‡πÄ‡∏ß‡∏ä","nickname":"‡πÑ‡∏≠‡∏ã‡πå","email":"m201030@school.ac.th","password_hash":"123456","class":"‡∏°.2/1","student_id":"M201030","role":"student"},{"member_id":"31","full_name":"‡∏™‡∏∏‡∏ä‡∏≤‡∏î‡∏≤ ‡∏à‡∏¥‡∏£‡∏†‡∏±‡∏ó‡∏£","nickname":"‡∏î‡∏£‡∏µ‡∏°","email":"m201031@school.ac.th","password_hash":"123456","class":"‡∏°.2/1","student_id":"M201031","role":"student"},{"member_id":"32","full_name":"‡∏®‡∏®‡∏¥‡∏ò‡∏£ ‡∏†‡∏±‡∏ó‡∏£‡∏û‡∏á‡∏©‡πå","nickname":"‡∏Å‡∏±‡∏ô‡∏ï‡πå","email":"m201032@school.ac.th","password_hash":"123456","class":"‡∏°.2/1","student_id":"M201032","role":"student"},{"member_id":"33","full_name":"‡∏Å‡∏§‡∏ï‡∏¥‡∏ô ‡πÑ‡∏û‡∏®‡∏≤‡∏•‡∏ä‡∏±‡∏¢","nickname":"‡∏ô‡∏±‡∏ó","email":"m201033@school.ac.th","password_hash":"123456","class":"‡∏°.2/1","student_id":"M201033","role":"student"},{"member_id":"34","full_name":"‡∏ò‡∏µ‡∏£‡∏†‡∏±‡∏ó‡∏£ ‡∏™‡∏≤‡∏£‡∏∞‡∏û‡∏á‡∏©‡πå","nickname":"‡∏ß‡∏¥‡∏ô","email":"m201034@school.ac.th","password_hash":"123456","class":"‡∏°.2/1","student_id":"M201034","role":"student"},{"member_id":"35","full_name":"‡∏•‡∏•‡∏¥‡∏ï‡∏≤ ‡∏à‡∏¥‡∏ï‡∏£‡∏™‡∏á‡πà‡∏≤","nickname":"‡∏î‡∏£‡∏µ‡∏°","email":"m201035@school.ac.th","password_hash":"123456","class":"‡∏°.2/1","student_id":"M201035","role":"student"},{"member_id":"36","full_name":"‡∏ä‡∏¢‡∏∏‡∏ï ‡πÄ‡∏ó‡∏ß‡∏§‡∏ó‡∏ò‡∏¥‡πå","nickname":"‡∏†‡∏µ‡∏°","email":"m201036@school.ac.th","password_hash":"123456","class":"‡∏°.2/1","student_id":"M201036","role":"student"},{"member_id":"37","full_name":"‡∏•‡∏•‡∏¥‡∏ï‡∏≤ ‡πÄ‡∏ó‡∏ß‡∏§‡∏ó‡∏ò‡∏¥‡πå","nickname":"‡∏à‡∏π‡∏ô","email":"m201037@school.ac.th","password_hash":"123456","class":"‡∏°.2/1","student_id":"M201037","role":"student"},{"member_id":"38","full_name":"‡∏≠‡∏±‡∏à‡∏à‡∏¥‡∏°‡∏≤ ‡πÇ‡∏û‡∏ò‡∏¥‡πå‡∏á‡∏≤‡∏°","nickname":"‡∏•‡∏¥‡∏•","email":"m201038@school.ac.th","password_hash":"123456","class":"‡∏°.2/1","student_id":"M201038","role":"student"},{"member_id":"39","full_name":"‡∏ô‡∏±‡∏ô‡∏ó‡πå‡∏ô‡∏†‡∏±‡∏™ ‡∏™‡∏Å‡∏∏‡∏•‡∏ô‡∏¥‡∏•","nickname":"‡∏Ñ‡∏¥‡∏ß","email":"m201039@school.ac.th","password_hash":"123456","class":"‡∏°.2/1","student_id":"M201039","role":"student"},{"member_id":"40","full_name":"‡∏ì‡∏±‡∏ê‡∏î‡∏ô‡∏±‡∏¢ ‡∏ß‡∏£‡πÄ‡∏ß‡∏ä","nickname":"‡∏Å‡∏±‡∏ô‡∏ï‡πå","email":"m201040@school.ac.th","password_hash":"123456","class":"‡∏°.2/1","student_id":"M201040","role":"student"},{"member_id":"281","full_name":"‡∏õ‡∏¥‡∏¢‡∏ò‡∏¥‡∏î‡∏≤ ‡∏≠‡∏±‡∏Ñ‡∏£‡πÄ‡∏î‡∏ä","nickname":"‡∏Å‡∏±‡∏ô‡∏ï‡πå","email":"m208001@school.ac.th","password_hash":"123456","class":"‡∏°.2/8","student_id":"M208001","role":"student"},{"member_id":"282","full_name":"‡∏ä‡∏•‡∏ò‡∏£ ‡∏†‡∏±‡∏ó‡∏£‡∏û‡∏á‡∏©‡πå","nickname":"‡∏î‡∏≤‡∏ß","email":"m208002@school.ac.th","password_hash":"123456","class":"‡∏°.2/8","student_id":"M208002","role":"student"},{"member_id":"283","full_name":"‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡∏≤ ‡∏≠‡∏±‡∏Ñ‡∏£‡πÄ‡∏î‡∏ä","nickname":"‡∏Ç‡∏ß‡∏±‡∏ç","email":"m208003@school.ac.th","password_hash":"123456","class":"‡∏°.2/8","student_id":"M208003","role":"student"},{"member_id":"284","full_name":"‡∏ò‡∏ô‡∏Å‡∏§‡∏ï ‡∏û‡∏á‡∏®‡πå‡∏û‡∏¥‡∏û‡∏±‡∏í‡∏ô‡πå","nickname":"‡∏ï‡∏±‡∏á‡∏Ñ‡πå","email":"m208004@school.ac.th","password_hash":"123456","class":"‡∏°.2/8","student_id":"M208004","role":"student"},{"member_id":"285","full_name":"‡∏Å‡∏§‡∏ï‡∏¥‡∏ô ‡∏à‡∏¥‡∏ï‡∏£‡∏™‡∏á‡πà‡∏≤","nickname":"‡∏°‡∏∞‡πÄ‡∏´‡∏°‡∏µ‡πà‡∏¢‡∏ß","email":"m208005@school.ac.th","password_hash":"123456","class":"‡∏°.2/8","student_id":"M208005","role":"student"},{"member_id":"286","full_name":"‡∏ò‡∏µ‡∏£‡∏®‡∏±‡∏Å‡∏î‡∏¥‡πå ‡πÄ‡∏à‡∏£‡∏¥‡∏ç‡∏™‡∏∏‡∏Ç","nickname":"‡∏à‡πä‡∏∞‡∏à‡πã‡∏≤","email":"m208006@school.ac.th","password_hash":"123456","class":"‡∏°.2/8","student_id":"M208006","role":"student"},{"member_id":"287","full_name":"‡∏≠‡∏£‡∏¥‡∏®‡∏£‡∏≤ ‡∏ò‡∏ô‡∏ß‡∏±‡∏í‡∏ô‡πå‡∏Å‡∏∏‡∏•","nickname":"‡∏î‡∏≤‡∏ß","email":"m208007@school.ac.th","password_hash":"123456","class":"‡∏°.2/8","student_id":"M208007","role":"student"},{"member_id":"288","full_name":"‡∏Ç‡∏ß‡∏±‡∏ç‡∏ä‡∏ô‡∏Å ‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏¥‡∏°‡∏á‡∏Ñ‡∏•","nickname":"‡∏°‡∏∏‡∏Å","email":"m208008@school.ac.th","password_hash":"123456","class":"‡∏°.2/8","student_id":"M208008","role":"student"},{"member_id":"289","full_name":"‡∏Å‡∏°‡∏•‡∏ß‡∏£‡∏£‡∏ì ‡∏Ñ‡∏ä‡∏™‡∏¥‡∏á‡∏´‡πå","nickname":"‡πÅ‡∏ô‡∏ô","email":"m208009@school.ac.th","password_hash":"123456","class":"‡∏°.2/8","student_id":"M208009","role":"student"},{"member_id":"290","full_name":"‡πÅ‡∏û‡∏£‡∏ß‡∏≤ ‡∏™‡∏∏‡∏ò‡∏µ","nickname":"‡∏ô‡πâ‡∏≥‡∏Ñ‡πâ‡∏≤‡∏á","email":"m208010@school.ac.th","password_hash":"123456","class":"‡∏°.2/8","student_id":"M208010","role":"student"},{"member_id":"291","full_name":"‡∏®‡∏∏‡∏†‡∏Å‡∏¥‡∏à ‡πÄ‡∏à‡∏£‡∏¥‡∏ç‡∏™‡∏∏‡∏Ç","nickname":"‡∏°‡∏≠‡∏™","email":"m208011@school.ac.th","password_hash":"123456","class":"‡∏°.2/8","student_id":"M208011","role":"student"},{"member_id":"292","full_name":"‡∏ò‡∏±‡∏ô‡∏ß‡∏≤ ‡∏ó‡∏±‡∏®‡∏ô‡∏µ‡∏¢‡πå","nickname":"‡∏û‡∏¥‡∏°","email":"m208012@school.ac.th","password_hash":"123456","class":"‡∏°.2/8","student_id":"M208012","role":"student"},{"member_id":"293","full_name":"‡∏•‡∏•‡∏¥‡∏ï‡∏≤ ‡∏ó‡∏±‡∏®‡∏ô‡∏µ‡∏¢‡πå","nickname":"‡∏£‡∏¥‡∏ß","email":"m208013@school.ac.th","password_hash":"123456","class":"‡∏°.2/8","student_id":"M208013","role":"student"},{"member_id":"294","full_name":"‡∏û‡∏¥‡∏°‡∏û‡πå‡∏•‡∏î‡∏≤ ‡∏ô‡∏§‡πÄ‡∏ö‡∏®","nickname":"‡∏û‡∏¥‡∏°","email":"m208014@school.ac.th","password_hash":"123456","class":"‡∏°.2/8","student_id":"M208014","role":"student"},{"member_id":"295","full_name":"‡∏ì‡∏±‡∏ê‡∏ô‡∏ô‡∏ó‡πå ‡∏ß‡∏≤‡∏£‡∏∏‡∏ì","nickname":"‡πÄ‡∏≠‡∏¥‡∏£‡πå‡∏ò","email":"m208015@school.ac.th","password_hash":"123456","class":"‡∏°.2/8","student_id":"M208015","role":"student"},{"member_id":"296","full_name":"‡πÄ‡∏û‡∏ä‡∏£‡∏±‡∏ï‡∏ô‡πå ‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏¥‡∏°‡∏á‡∏Ñ‡∏•","nickname":"‡πÇ‡∏°","email":"m208016@school.ac.th","password_hash":"123456","class":"‡∏°.2/8","student_id":"M208016","role":"student"},{"member_id":"297","full_name":"‡∏õ‡∏¥‡∏¢‡∏∞ ‡∏Å‡∏¥‡∏ï‡∏ï‡∏¥‡∏Ñ‡∏∏‡∏ì","nickname":"‡∏û‡∏¥‡∏°","email":"m208017@school.ac.th","password_hash":"123456","class":"‡∏°.2/8","student_id":"M208017","role":"student"},{"member_id":"298","full_name":"‡∏®‡∏¥‡∏ß‡∏Å‡∏£‡∏ì‡πå ‡∏™‡∏≤‡∏£‡∏∞‡∏û‡∏á‡∏©‡πå","nickname":"‡∏≠‡∏¥‡∏á","email":"m208018@school.ac.th","password_hash":"123456","class":"‡∏°.2/8","student_id":"M208018","role":"student"},{"member_id":"299","full_name":"‡∏™‡∏´‡∏†‡∏π‡∏°‡∏¥ ‡∏Å‡∏≤‡∏ç‡∏à‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå","nickname":"‡πÇ‡∏ö‡πä‡∏ó","email":"m208019@school.ac.th","password_hash":"123456","class":"‡∏°.2/8","student_id":"M208019","role":"student"},{"member_id":"300","full_name":"‡∏û‡∏¥‡∏ä‡∏ç‡∏≤‡∏†‡∏≤ ‡∏ó‡∏µ‡∏õ‡∏±‡∏á‡∏Å‡∏£","nickname":"‡πÄ‡∏≠‡∏¥‡∏£‡πå‡∏ò","email":"m208020@school.ac.th","password_hash":"123456","class":"‡∏°.2/8","student_id":"M208020","role":"student"},{"member_id":"301","full_name":"‡∏ß‡∏ä‡∏¥‡∏£‡∏ß‡∏¥‡∏ä‡∏ç‡πå ‡∏≠‡∏¥‡∏ô‡∏ó‡∏£‡∏≤","nickname":"‡∏ô‡∏¥‡∏ß","email":"m208021@school.ac.th","password_hash":"123456","class":"‡∏°.2/8","student_id":"M208021","role":"student"},{"member_id":"302","full_name":"‡∏®‡∏¥‡∏ß‡∏Å‡∏£‡∏ì‡πå ‡∏™‡∏∏‡∏ò‡∏µ","nickname":"‡∏•‡∏π‡∏Å‡∏ô‡πâ‡∏≥","email":"m208022@school.ac.th","password_hash":"123456","class":"‡∏°.2/8","student_id":"M208022","role":"student"},{"member_id":"303","full_name":"‡∏®‡∏®‡∏¥‡∏ò‡∏£ ‡∏≠‡∏±‡∏Ñ‡∏£‡πÄ‡∏î‡∏ä","nickname":"‡πÄ‡∏Å‡∏•","email":"m208023@school.ac.th","password_hash":"123456","class":"‡∏°.2/8","student_id":"M208023","role":"student"},{"member_id":"304","full_name":"‡∏ì‡∏±‡∏ê‡∏ß‡∏∏‡∏í‡∏¥ ‡∏°‡∏á‡∏Ñ‡∏•‡∏û‡∏á‡∏®‡πå","nickname":"‡∏°‡∏¥‡∏ô","email":"m208024@school.ac.th","password_hash":"123456","class":"‡∏°.2/8","student_id":"M208024","role":"student"},{"member_id":"305","full_name":"‡∏ß‡∏£‡∏±‡∏•‡∏ä‡∏ç‡∏≤ ‡∏ß‡∏≤‡∏£‡∏∏‡∏ì","nickname":"‡πÄ‡∏ä‡∏≠‡∏£‡∏µ‡πà","email":"m208025@school.ac.th","password_hash":"123456","class":"‡∏°.2/8","student_id":"M208025","role":"student"},{"member_id":"306","full_name":"‡∏≠‡∏±‡∏ç‡∏ä‡∏¥‡∏™‡∏≤ ‡∏ô‡∏§‡πÄ‡∏ö‡∏®","nickname":"‡πÅ‡∏ö‡∏á‡∏Ñ‡πå","email":"m208026@school.ac.th","password_hash":"123456","class":"‡∏°.2/8","student_id":"M208026","role":"student"},{"member_id":"307","full_name":"‡∏õ‡∏£‡πÄ‡∏°‡∏®‡∏ß‡∏£‡πå ‡∏ß‡∏≤‡∏£‡∏∏‡∏ì","nickname":"‡∏°‡∏¥‡∏ß","email":"m208027@school.ac.th","password_hash":"123456","class":"‡∏°.2/8","student_id":"M208027","role":"student"},{"member_id":"308","full_name":"‡∏ä‡∏¢‡∏∏‡∏ï ‡∏à‡∏¥‡∏ï‡∏£‡∏™‡∏á‡πà‡∏≤","nickname":"‡πÑ‡∏ü‡∏•‡πå‡∏ó","email":"m208028@school.ac.th","password_hash":"123456","class":"‡∏°.2/8","student_id":"M208028","role":"student"},{"member_id":"311","full_name":"‡∏ò‡∏ô‡∏ß‡∏±‡∏í‡∏ô‡πå ‡∏Å‡∏¥‡∏ï‡∏ï‡∏¥‡πÄ‡∏î‡∏ä","nickname":"‡∏Ç‡πâ‡∏≤‡∏ß‡∏õ‡∏±‡πâ‡∏ô","email":"m209001@school.ac.th","password_hash":"123456","class":"‡∏°.2/9","student_id":"M209001","role":"student"},{"member_id":"312","full_name":"‡∏û‡∏ä‡∏£ ‡∏ß‡∏£‡πÄ‡∏ß‡∏ä","nickname":"‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•","email":"m209002@school.ac.th","password_hash":"123456","class":"‡∏°.2/9","student_id":"M209002","role":"student"},{"member_id":"313","full_name":"‡∏ç‡∏≤‡∏î‡∏≤ ‡∏û‡∏á‡∏©‡πå‡∏ó‡∏≠‡∏á","nickname":"‡∏≠‡πâ‡∏ô","email":"m209003@school.ac.th","password_hash":"123456","class":"‡∏°.2/9","student_id":"M209003","role":"student"},{"member_id":"314","full_name":"‡∏õ‡∏ß‡∏µ‡∏ì‡∏≤ ‡∏õ‡∏¥‡∏¢‡∏∞‡∏ò‡∏¥‡∏î‡∏≤","nickname":"‡∏≠‡∏≤‡∏£‡πå‡∏ï","email":"m209004@school.ac.th","password_hash":"123456","class":"‡∏°.2/9","student_id":"M209004","role":"student"},{"member_id":"315","full_name":"‡∏ò‡∏¥‡∏î‡∏≤‡∏£‡∏±‡∏ï‡∏ô‡πå ‡∏à‡∏¥‡∏£‡∏†‡∏±‡∏ó‡∏£","nickname":"‡∏Ç‡∏ß‡∏±‡∏ç","email":"m209005@school.ac.th","password_hash":"123456","class":"‡∏°.2/9","student_id":"M209005","role":"student"},{"member_id":"316","full_name":"‡∏†‡∏±‡∏ó‡∏£‡∏û‡∏£ ‡∏Å‡∏≤‡∏ç‡∏à‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå","nickname":"‡∏¢‡∏π‡∏Å‡∏¥","email":"m209006@school.ac.th","password_hash":"123456","class":"‡∏°.2/9","student_id":"M209006","role":"student"},{"member_id":"317","full_name":"‡∏Å‡∏°‡∏•‡∏ß‡∏£‡∏£‡∏ì ‡πÄ‡∏à‡∏£‡∏¥‡∏ç‡∏™‡∏∏‡∏Ç","nickname":"‡∏†‡∏µ‡∏°","email":"m209007@school.ac.th","password_hash":"123456","class":"‡∏°.2/9","student_id":"M209007","role":"student"},{"member_id":"318","full_name":"‡∏ä‡∏ç‡∏≤‡∏ô‡∏¥‡∏® ‡∏ö‡∏∏‡∏ç‡πÄ‡∏Å‡∏¥‡∏î","nickname":"‡∏¢‡∏µ‡∏ô‡∏™‡πå","email":"m209008@school.ac.th","password_hash":"123456","class":"‡∏°.2/9","student_id":"M209008","role":"student"},{"member_id":"319","full_name":"‡∏õ‡∏¥‡∏¢‡∏ß‡∏±‡∏í‡∏ô‡πå ‡∏ß‡∏¥‡πÄ‡∏®‡∏©‡∏®‡∏£‡∏µ","nickname":"‡πÇ‡∏¢","email":"m209009@school.ac.th","password_hash":"123456","class":"‡∏°.2/9","student_id":"M209009","role":"student"},{"member_id":"320","full_name":"‡∏ì‡∏±‡∏ê‡∏ô‡∏ô‡∏ó‡πå ‡∏ô‡∏ß‡∏•‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå","nickname":"‡∏à‡πä‡∏∞‡∏à‡πã‡∏≤","email":"m209010@school.ac.th","password_hash":"123456","class":"‡∏°.2/9","student_id":"M209010","role":"student"},{"member_id":"321","full_name":"‡∏û‡∏ä‡∏£ ‡∏®‡∏¥‡∏£‡∏¥‡∏ß‡∏±‡∏í‡∏ô‡πå","nickname":"‡πÄ‡∏à","email":"m209011@school.ac.th","password_hash":"123456","class":"‡∏°.2/9","student_id":"M209011","role":"student"},{"member_id":"322","full_name":"‡∏™‡∏´‡∏†‡∏π‡∏°‡∏¥ ‡∏Ñ‡∏ä‡∏™‡∏¥‡∏á‡∏´‡πå","nickname":"‡∏û‡∏µ‡∏Ñ","email":"m209012@school.ac.th","password_hash":"123456","class":"‡∏°.2/9","student_id":"M209012","role":"student"},{"member_id":"323","full_name":"‡∏ä‡∏ô‡∏≤‡∏ò‡∏¥‡∏õ ‡∏®‡∏£‡∏µ‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏¥‡πå","nickname":"‡πÄ‡∏ï‡∏¢","email":"m209013@school.ac.th","password_hash":"123456","class":"‡∏°.2/9","student_id":"M209013","role":"student"},{"member_id":"324","full_name":"‡∏®‡∏¥‡∏£‡∏¥‡∏ô‡∏†‡∏≤ ‡∏†‡∏±‡∏ó‡∏£‡∏û‡∏á‡∏©‡πå","nickname":"‡πÇ‡∏°","email":"m209014@school.ac.th","password_hash":"123456","class":"‡∏°.2/9","student_id":"M209014","role":"student"},{"member_id":"325","full_name":"‡∏ß‡∏£‡∏±‡∏•‡∏ä‡∏ç‡∏≤ ‡∏≠‡∏†‡∏¥‡∏ß‡∏±‡∏í‡∏ô‡πå","nickname":"‡∏ß‡∏¥‡∏ô","email":"m209015@school.ac.th","password_hash":"123456","class":"‡∏°.2/9","student_id":"M209015","role":"student"},{"member_id":"326","full_name":"‡∏ò‡∏±‡∏ô‡∏ß‡∏≤ ‡∏õ‡∏±‡∏ç‡∏ç‡∏≤","nickname":"‡∏°‡∏¥‡∏ô","email":"m209016@school.ac.th","password_hash":"123456","class":"‡∏°.2/9","student_id":"M209016","role":"student"},{"member_id":"327","full_name":"‡∏õ‡∏∏‡∏ì‡∏¢‡∏≤‡∏û‡∏£ ‡∏ä‡∏≤‡∏ç‡∏ß‡∏∏‡∏í‡∏¥","nickname":"‡∏û‡∏µ‡∏Ñ","email":"m209017@school.ac.th","password_hash":"123456","class":"‡∏°.2/9","student_id":"M209017","role":"student"},{"member_id":"328","full_name":"‡∏ê‡∏≤‡∏õ‡∏ô‡∏µ‡∏¢‡πå ‡∏™‡∏≤‡∏£‡∏∞‡∏û‡∏á‡∏©‡πå","nickname":"‡∏Ñ‡∏¥‡∏ß","email":"m209018@school.ac.th","password_hash":"123456","class":"‡∏°.2/9","student_id":"M209018","role":"student"},{"member_id":"329","full_name":"‡∏û‡∏•‡∏≠‡∏¢‡πÑ‡∏û‡∏•‡∏¥‡∏ô ‡πÇ‡∏†‡∏Ñ‡∏¥‡∏ô","nickname":"‡∏à‡πä‡∏∞‡∏à‡πã‡∏≤","email":"m209019@school.ac.th","password_hash":"123456","class":"‡∏°.2/9","student_id":"M209019","role":"student"},{"member_id":"330","full_name":"‡∏ô‡∏§‡∏î‡∏° ‡πÄ‡∏£‡∏∑‡∏≠‡∏á‡πÄ‡∏î‡∏ä","nickname":"‡∏°‡∏¥‡∏ß","email":"m209020@school.ac.th","password_hash":"123456","class":"‡∏°.2/9","student_id":"M209020","role":"student"},{"member_id":"331","full_name":"‡∏õ‡∏≤‡∏ì‡∏¥‡∏™‡∏£‡∏≤ ‡∏Å‡∏¥‡∏ï‡∏ï‡∏¥‡∏ß‡∏≤‡∏ô‡∏¥‡∏ä","nickname":"‡∏•‡∏¥‡∏•","email":"m209021@school.ac.th","password_hash":"123456","class":"‡∏°.2/9","student_id":"M209021","role":"student"},{"member_id":"332","full_name":"‡∏ò‡∏ô‡∏ß‡∏±‡∏í‡∏ô‡πå ‡∏ô‡∏†‡∏≤‡∏û‡∏£","nickname":"‡∏û‡∏¥‡∏á‡∏Ñ‡πå","email":"m209022@school.ac.th","password_hash":"123456","class":"‡∏°.2/9","student_id":"M209022","role":"student"},{"member_id":"333","full_name":"‡∏ô‡∏†‡∏î‡∏• ‡∏ö‡∏∏‡∏ç‡πÄ‡∏Å‡∏¥‡∏î","nickname":"‡∏ô‡πâ‡∏≥‡∏´‡∏ß‡∏≤‡∏ô","email":"m209023@school.ac.th","password_hash":"123456","class":"‡∏°.2/9","student_id":"M209023","role":"student"},{"member_id":"334","full_name":"‡∏ô‡∏±‡∏ô‡∏ó‡∏ß‡∏∏‡∏í‡∏¥ ‡∏ê‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏ô‡∏ï‡πå","nickname":"‡∏†‡∏µ‡∏°","email":"m209024@school.ac.th","password_hash":"123456","class":"‡∏°.2/9","student_id":"M209024","role":"student"},{"member_id":"335","full_name":"‡∏õ‡∏¥‡∏¢‡∏∞ ‡∏≠‡∏¥‡∏ô‡∏ó‡∏£‡πå‡∏≠‡∏∏‡∏î‡∏°","nickname":"‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•","email":"m209025@school.ac.th","password_hash":"123456","class":"‡∏°.2/9","student_id":"M209025","role":"student"},{"member_id":"336","full_name":"‡∏™‡∏∏‡∏ä‡∏≤‡∏î‡∏≤ ‡∏†‡∏±‡∏ó‡∏£‡∏û‡∏á‡∏©‡πå","nickname":"‡∏Ç‡πâ‡∏≤‡∏ß‡∏õ‡∏±‡πâ‡∏ô","email":"m209026@school.ac.th","password_hash":"123456","class":"‡∏°.2/9","student_id":"M209026","role":"student"},{"member_id":"337","full_name":"‡∏õ‡∏∏‡∏ì‡∏¢‡∏≤‡∏û‡∏£ ‡∏à‡∏¥‡∏ï‡∏£‡∏™‡∏á‡πà‡∏≤","nickname":"‡∏î‡∏£‡∏µ‡∏°","email":"m209027@school.ac.th","password_hash":"123456","class":"‡∏°.2/9","student_id":"M209027","role":"student"},{"member_id":"338","full_name":"‡∏ì‡∏±‡∏ê‡∏ä‡∏ô‡∏¥‡∏©‡∏≤ ‡∏ä‡∏π‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥","nickname":"‡∏ã‡∏≤‡∏£‡πà‡∏≤","email":"m209028@school.ac.th","password_hash":"123456","class":"‡∏°.2/9","student_id":"M209028","role":"student"},{"member_id":"339","full_name":"‡∏†‡∏±‡∏ó‡∏£‡∏û‡∏£ ‡∏≠‡∏£‡∏∏‡∏ì‡∏£‡∏±‡∏Å‡∏©‡πå","nickname":"‡πÇ‡∏°","email":"m209029@school.ac.th","password_hash":"123456","class":"‡∏°.2/9","student_id":"M209029","role":"student"},{"member_id":"340","full_name":"‡∏ß‡∏ä‡∏¥‡∏£‡∏ß‡∏¥‡∏ä‡∏ç‡πå ‡∏®‡∏£‡∏µ‡∏™‡∏á‡πà‡∏≤","nickname":"‡∏ô‡∏±‡∏ó","email":"m209030@school.ac.th","password_hash":"123456","class":"‡∏°.2/9","student_id":"M209030","role":"student"}];
        const DB_ATTEMPTS = [{"member_id":1,"mission_id":1,"attempt_no":1,"correct":7,"exp_gained":70,"coin_gained":1000,"badges":"Maze Master","time_total_sec":77,"pass":true},{"member_id":1,"mission_id":2,"attempt_no":1,"correct":6,"exp_gained":60,"coin_gained":0,"badges":"Power Collector","time_total_sec":56,"pass":true},{"member_id":2,"mission_id":1,"attempt_no":1,"correct":9,"exp_gained":90,"coin_gained":1000,"badges":"Maze Master","time_total_sec":112,"pass":true},{"member_id":3,"mission_id":1,"attempt_no":1,"correct":4,"exp_gained":40,"coin_gained":0,"badges":"","time_total_sec":130,"pass":false},{"member_id":3,"mission_id":1,"attempt_no":2,"correct":8,"exp_gained":80,"coin_gained":1000,"badges":"Maze Master","time_total_sec":95,"pass":true},{"member_id":4,"mission_id":1,"attempt_no":1,"correct":10,"exp_gained":100,"coin_gained":1000,"badges":"Maze Master","time_total_sec":65,"pass":true},{"member_id":4,"mission_id":2,"attempt_no":1,"correct":8,"exp_gained":80,"coin_gained":0,"badges":"Power Collector","time_total_sec":88,"pass":true},{"member_id":4,"mission_id":3,"attempt_no":1,"correct":9,"exp_gained":90,"coin_gained":0,"badges":"Science Explorer","time_total_sec":120,"pass":true},{"member_id":5,"mission_id":1,"attempt_no":1,"correct":5,"exp_gained":50,"coin_gained":0,"badges":"","time_total_sec":150,"pass":false}];
        const DB_PRE_TESTS = [{"member_id":1,"score":2},{"member_id":2,"score":5},{"member_id":3,"score":4},{"member_id":4,"score":1},{"member_id":5,"score":3},{"member_id":6,"score":6},{"member_id":7,"score":0},{"member_id":8,"score":3},{"member_id":9,"score":5},{"member_id":10,"score":2},{"member_id":11,"score":2},{"member_id":12,"score":3},{"member_id":13,"score":6},{"member_id":14,"score":3},{"member_id":15,"score":3},{"member_id":16,"score":3},{"member_id":17,"score":7},{"member_id":18,"score":7},{"member_id":19,"score":5},{"member_id":20,"score":4},{"member_id":21,"score":5},{"member_id":22,"score":6},{"member_id":23,"score":2},{"member_id":24,"score":5},{"member_id":25,"score":2},{"member_id":26,"score":3},{"member_id":27,"score":5},{"member_id":28,"score":1},{"member_id":29,"score":3},{"member_id":30,"score":2},{"member_id":31,"score":3},{"member_id":32,"score":0},{"member_id":33,"score":1},{"member_id":34,"score":2},{"member_id":35,"score":5},{"member_id":36,"score":3},{"member_id":37,"score":4},{"member_id":38,"score":5},{"member_id":39,"score":2},{"member_id":40,"score":4},{"member_id":280,"score":2},{"member_id":281,"score":2},{"member_id":282,"score":2},{"member_id":283,"score":1},{"member_id":284,"score":3},{"member_id":285,"score":3},{"member_id":286,"score":2},{"member_id":287,"score":1},{"member_id":288,"score":5},{"member_id":289,"score":2},{"member_id":290,"score":4},{"member_id":291,"score":2},{"member_id":292,"score":5},{"member_id":293,"score":5},{"member_id":294,"score":2},{"member_id":295,"score":1},{"member_id":296,"score":5},{"member_id":297,"score":6},{"member_id":298,"score":4},{"member_id":299,"score":4},{"member_id":300,"score":5},{"member_id":301,"score":5},{"member_id":302,"score":2},{"member_id":303,"score":3},{"member_id":304,"score":4},{"member_id":305,"score":3},{"member_id":306,"score":5},{"member_id":307,"score":2},{"member_id":308,"score":5},{"member_id":309,"score":4},{"member_id":310,"score":3},{"member_id":311,"score":5},{"member_id":312,"score":5},{"member_id":313,"score":2},{"member_id":314,"score":4},{"member_id":315,"score":6},{"member_id":316,"score":3},{"member_id":317,"score":3},{"member_id":318,"score":2},{"member_id":319,"score":3},{"member_id":320,"score":5},{"member_id":321,"score":2},{"member_id":322,"score":1},{"member_id":323,"score":3},{"member_id":324,"score":1},{"member_id":325,"score":4},{"member_id":326,"score":3},{"member_id":327,"score":1},{"member_id":328,"score":3},{"member_id":329,"score":3},{"member_id":330,"score":4},{"member_id":331,"score":3},{"member_id":332,"score":6},{"member_id":333,"score":3},{"member_id":334,"score":3},{"member_id":335,"score":3},{"member_id":336,"score":3},{"member_id":337,"score":4},{"member_id":338,"score":4},{"member_id":339,"score":6},{"member_id":340,"score":1}];
        const DB_POST_TESTS = [{"member_id":1,"score":8},{"member_id":2,"score":9},{"member_id":3,"score":7},{"member_id":4,"score":8},{"member_id":5,"score":6},{"member_id":6,"score":8},{"member_id":7,"score":7},{"member_id":8,"score":7},{"member_id":9,"score":4},{"member_id":10,"score":7},{"member_id":11,"score":8},{"member_id":12,"score":7},{"member_id":13,"score":7},{"member_id":14,"score":4},{"member_id":15,"score":8},{"member_id":16,"score":8},{"member_id":17,"score":8},{"member_id":18,"score":9},{"member_id":19,"score":8},{"member_id":20,"score":2},{"member_id":21,"score":6},{"member_id":22,"score":8},{"member_id":23,"score":5},{"member_id":24,"score":7},{"member_id":25,"score":6},{"member_id":26,"score":7},{"member_id":27,"score":7},{"member_id":28,"score":8},{"member_id":29,"score":6},{"member_id":30,"score":8},{"member_id":31,"score":9},{"member_id":32,"score":7},{"member_id":33,"score":7},{"member_id":34,"score":7},{"member_id":35,"score":7},{"member_id":36,"score":6},{"member_id":37,"score":8},{"member_id":38,"score":9},{"member_id":39,"score":8},{"member_id":40,"score":8},{"member_id":280,"score":7},{"member_id":281,"score":8},{"member_id":282,"score":6},{"member_id":283,"score":7},{"member_id":284,"score":7},{"member_id":285,"score":8},{"member_id":286,"score":8},{"member_id":287,"score":7},{"member_id":288,"score":9},{"member_id":289,"score":7},{"member_id":290,"score":9},{"member_id":291,"score":6},{"member_id":292,"score":8},{"member_id":293,"score":9},{"member_id":294,"score":8},{"member_id":295,"score":8},{"member_id":296,"score":9},{"member_id":297,"score":7},{"member_id":298,"score":8},{"member_id":299,"score":9},{"member_id":300,"score":7},{"member_id":301,"score":8},{"member_id":302,"score":7},{"member_id":303,"score":7},{"member_id":304,"score":8},{"member_id":305,"score":5},{"member_id":306,"score":7},{"member_id":307,"score":6},{"member_id":308,"score":9},{"member_id":309,"score":9},{"member_id":310,"score":7},{"member_id":311,"score":9},{"member_id":312,"score":8},{"member_id":313,"score":8},{"member_id":314,"score":8},{"member_id":315,"score":7},{"member_id":316,"score":8},{"member_id":317,"score":7},{"member_id":318,"score":1},{"member_id":319,"score":8},{"member_id":320,"score":8},{"member_id":321,"score":9},{"member_id":322,"score":9},{"member_id":323,"score":9},{"member_id":324,"score":7},{"member_id":325,"score":7},{"member_id":326,"score":6},{"member_id":327,"score":8},{"member_id":328,"score":9},{"member_id":329,"score":7},{"member_id":330,"score":8},{"member_id":331,"score":7},{"member_id":332,"score":7},{"member_id":333,"score":6},{"member_id":334,"score":7},{"member_id":335,"score":7},{"member_id":336,"score":7},{"member_id":337,"score":9},{"member_id":338,"score":7},{"member_id":339,"score":7},{"member_id":340,"score":4}];
        const DB_QUESTIONS = [
             // Mission 1: ‡∏ô‡∏¥‡∏¢‡∏≤‡∏°‡πÅ‡∏•‡∏∞‡∏≠‡∏á‡∏Ñ‡πå‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö
             { mission_id: 1, level: 'easy', question: "2¬≥ ‡∏°‡∏µ‡∏Ñ‡πà‡∏≤‡πÄ‡∏ó‡πà‡∏≤‡πÉ‡∏î?", options: ["6", "8", "9", "12"], correct: 1, explanation: "2¬≥ = 2 √ó 2 √ó 2 = 8" },
             { mission_id: 1, level: 'easy', question: "‡πÉ‡∏ô‡πÄ‡∏•‡∏Ç‡∏¢‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á 5‚Å¥ ‡∏ê‡∏≤‡∏ô‡∏Ñ‡∏∑‡∏≠‡πÄ‡∏•‡∏Ç‡πÉ‡∏î?", options: ["4", "5", "9", "20"], correct: 1, explanation: "‡πÉ‡∏ô‡πÄ‡∏•‡∏Ç‡∏¢‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á ‡∏ê‡∏≤‡∏ô (base) ‡∏Ñ‡∏∑‡∏≠‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á ‡∏ã‡∏∂‡πà‡∏á‡∏Ñ‡∏∑‡∏≠ 5" },
             { mission_id: 1, level: 'easy', question: "3¬≤ ‡∏°‡∏µ‡∏Ñ‡πà‡∏≤‡πÄ‡∏ó‡πà‡∏≤‡πÉ‡∏î?", options: ["6", "9", "12", "15"], correct: 1, explanation: "3¬≤ = 3 √ó 3" },
             { mission_id: 1, level: 'easy', question: "4¬π ‡∏°‡∏µ‡∏Ñ‡πà‡∏≤‡πÄ‡∏ó‡πà‡∏≤‡πÉ‡∏î?", options: ["1", "4", "0", "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡πà‡∏≤"], correct: 1, explanation: "‡πÄ‡∏•‡∏Ç‡πÉ‡∏î‡∏Å‡πá‡∏ï‡∏≤‡∏°‡∏¢‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á 1 = ‡∏ï‡∏±‡∏ß‡∏°‡∏±‡∏ô‡πÄ‡∏≠‡∏á" },
             { mission_id: 1, level: 'medium', question: "(-3)¬≤ ‡∏°‡∏µ‡∏Ñ‡πà‡∏≤‡πÄ‡∏ó‡πà‡∏≤‡πÉ‡∏î?", options: ["-9", "9", "-6", "6"], correct: 1, explanation: "(-3)¬≤ = (-3) √ó (-3) = 9 (‡∏•‡∏ö‡∏Ñ‡∏π‡∏ì‡∏•‡∏ö‡πÑ‡∏î‡πâ‡∏ö‡∏ß‡∏Å)" },
             { mission_id: 1, level: 'medium', question: "‡∏ê‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á 16¬≥ ‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?", options: ["16", "3", "16¬≥", "48"], correct: 0, explanation: "‡∏ê‡∏≤‡∏ô‡∏Ñ‡∏∑‡∏≠‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏¢‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á ‡∏ã‡∏∂‡πà‡∏á‡∏Å‡πá‡∏Ñ‡∏∑‡∏≠ 16" },
             { mission_id: 1, level: 'medium', question: "‡∏ê‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á -(3)¬≥ ‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?", options: ["-3", "3", "-27", "27"], correct: 0, explanation: "‡∏ê‡∏≤‡∏ô‡∏Ñ‡∏∑‡∏≠‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ß‡∏á‡πÄ‡∏•‡πá‡∏ö ‡∏ã‡∏∂‡πà‡∏á‡∏Å‡πá‡∏Ñ‡∏∑‡∏≠ -3" },
             { mission_id: 1, level: 'hard', question: "100‚Å∞ ‡∏°‡∏µ‡∏Ñ‡πà‡∏≤‡πÄ‡∏ó‡πà‡∏≤‡πÉ‡∏î?", options: ["0", "1", "100", "10"], correct: 1, explanation: "‡πÄ‡∏•‡∏Ç‡πÉ‡∏î‡πÜ (‡∏¢‡∏Å‡πÄ‡∏ß‡πâ‡∏ô 0) ‡∏ó‡∏µ‡πà‡∏¢‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á 0 ‡∏à‡∏∞‡∏°‡∏µ‡∏Ñ‡πà‡∏≤‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ö 1 ‡πÄ‡∏™‡∏°‡∏≠" },
             { mission_id: 1, level: 'hard', question: "(-1)¬π‚Å∞‚Å∞ ‡∏°‡∏µ‡∏Ñ‡πà‡∏≤‡πÄ‡∏ó‡πà‡∏≤‡πÉ‡∏î?", options: ["-1", "1", "-100", "100"], correct: 1, explanation: "‡πÄ‡∏•‡∏Ç‡∏•‡∏ö‡∏¢‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡∏π‡πà‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏Ñ‡πà‡∏≤‡∏ö‡∏ß‡∏Å‡πÄ‡∏™‡∏°‡∏≠ ‡πÅ‡∏•‡∏∞ 1 ‡∏¢‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏∞‡πÑ‡∏£‡∏Å‡πá‡πÑ‡∏î‡πâ 1" },
             { mission_id: 1, level: 'hard', question: "‡∏Ç‡πâ‡∏≠‡πÉ‡∏î‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô 8 √ó 8 √ó 8 ‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÄ‡∏•‡∏Ç‡∏¢‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á?", options: ["3‚Å∏", "8¬≥", "8 √ó 3", "24"], correct: 1, explanation: "8 ‡∏Ñ‡∏π‡∏ì‡∏Å‡∏±‡∏ô 3 ‡∏ï‡∏±‡∏ß ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏õ‡πá‡∏ô 8¬≥" }
        ];
        
        const MOCK_CLASSES = [
            { name: '‡∏°.2/1 ‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô', subject: '‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå', students: 40 },
            { name: '2/8 ‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô EIS ', subject: '‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå', students: 27 },
            { name: '2/9 ‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô EIS', subject: '‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå', students: 30}
        ];

        let currentUser = {};
        let currentQuiz = {};
        let currentGame = {};

        // --- Basic UI Control ---
        function showStudentSection(sectionId) {
            document.querySelectorAll('.student-section-content').forEach(s => s.classList.add('hidden'));
            document.getElementById(`section-${sectionId}`).classList.remove('hidden');
            document.querySelectorAll('.student-nav').forEach(b => {
                b.classList.remove('border-purple-500', 'text-purple-600');
                b.classList.add('border-transparent', 'text-gray-600');
            });
            document.getElementById(`nav-${sectionId}`).classList.add('border-purple-500', 'text-purple-600');
            
            // Specifically for student leaderboard
            if (sectionId === 'leaderboard') {
                 const studentLeaderboardData = getFullLeaderboardData();
                 populateLeaderboard('studentLeaderboardContainer', studentLeaderboardData);
            }
        }
        
        function showTeacherSection(sectionId) {
            document.querySelectorAll('.teacher-section-content').forEach(s => s.classList.add('hidden'));
            document.getElementById(`section-${sectionId}`).classList.remove('hidden');
            document.querySelectorAll('.teacher-nav').forEach(b => {
                b.classList.remove('border-purple-500', 'text-purple-600');
                b.classList.add('border-transparent', 'text-gray-600');
            });
            document.getElementById(`nav-${sectionId}`).classList.add('border-purple-500', 'text-purple-600');
        }

        function showScreen(screenId) {
            ['loginScreen', 'characterScreen', 'studentDashboard', 'teacherDashboard'].forEach(id => {
                const el = document.getElementById(id);
                if(el) el.style.display = 'none';
            });
             const targetScreen = document.getElementById(screenId);
             if(targetScreen) {
                 targetScreen.style.display = (screenId === 'loginScreen' || screenId === 'characterScreen') ? 'flex' : 'block';
             }
        }

        // --- Login & Logout Logic ---
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;

            if (username.toLowerCase() === 'teacher' && password === 'admin123') {
                loginAsTeacher();
            } else if (username.toLowerCase() === 'demo' && password === 'demo') {
                currentUser = { role: 'student', member_id: 'demo', full_name: '‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏≤‡∏ò‡∏¥‡∏ï', nickname: '‡πÄ‡∏î‡πÇ‡∏°‡πà', class: 'Demo Class'};
                loginAsStudent(currentUser);
            } else {
                const student = DB_MEMBERS.find(m => m.student_id.toLowerCase() === username.toLowerCase());
                if (student && student.password_hash === password) {
                    currentUser = student;
                    loginAsStudent(currentUser);
                } else {
                    showNotification('‡∏£‡∏´‡∏±‡∏™‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', 'error');
                }
            }
        });
        
        function loginAsStudent(userData) {
            if (userData.member_id === 'demo') {
                 showScreen('characterScreen');
            } else {
                 showScreen('studentDashboard');
                 loadStudentData(userData.member_id);
            }
        }

        function loginAsTeacher() {
            showScreen('teacherDashboard');
            loadTeacherData();
        }

        function logout() {
            currentUser = {};
            currentQuiz = {};
            currentGame = {};
            showScreen('loginScreen');
        }
        
        // --- Character Selection (For Demo User) ---
        let selectedAvatar = null;
        function selectCharacter(gender) {
            selectedAvatar = gender;
            document.querySelectorAll('.character-option').forEach(el => el.classList.remove('selected'));
            document.getElementById(`char-${gender}`).classList.add('selected');
            document.getElementById('confirmCharacter').disabled = !document.getElementById('nicknameInput').value.trim();
        }
        
        document.getElementById('nicknameInput').addEventListener('input', function() {
            document.getElementById('confirmCharacter').disabled = !this.value.trim() || !selectedAvatar;
        });

        function confirmCharacterSelection() {
            const nickname = document.getElementById('nicknameInput').value.trim();
            if (!nickname || !selectedAvatar) return;
            
            currentUser.nickname = nickname;
            showScreen('studentDashboard');
            loadStudentData('demo'); // Load data after screen is visible
        }

        function resetDemoData() {
            if (currentUser && currentUser.member_id === 'demo') {
                // Re-initialize the demo user's data to a fresh state
                currentUser.data = {
                    profile: { name: currentUser.nickname, class: 'Demo Class' },
                    stats: { level: 1, exp: 0, exp_to_next: 100, coins: 1000, completedMissionsCount: 0, totalPlayTime: 0, accuracy: 0, levelGroup: null },
                    progress: { preTest: null, postTest: null, completedMissions: [], badges: [] }
                };
                
                // Re-render the UI with the fresh data
                updateStudentUI(currentUser.data);
                
                // Manually reset the test cards to their initial HTML state
                document.getElementById('preTestContent').innerHTML = `
                    <p class="text-gray-600 mb-4">‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô</p>
                    <button onclick="startTest('pre')" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg font-semibold transition-colors">
                        üöÄ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö
                    </button>
                `;
                document.getElementById('postTestContent').innerHTML = `
                    <p class="text-gray-500 mb-4">‡∏ú‡πà‡∏≤‡∏ô‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏ó‡∏±‡πâ‡∏á 3 ‡∏î‡πà‡∏≤‡∏ô‡∏Å‡πà‡∏≠‡∏ô</p>
                    <button id="postTestBtn" onclick="startTest('post')" class="bg-gray-300 text-gray-500 px-6 py-2 rounded-lg font-semibold cursor-not-allowed" disabled>
                        üîí ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°
                    </button>
                `;
                
                showNotification('‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡πÇ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÅ‡∏•‡πâ‡∏ß', 'success');
            }
        }

        // --- Data Loading & Processing ---
        function getStudentDataById(memberId) {
             const userProfile = DB_MEMBERS.find(m => m.member_id == memberId);
             if (!userProfile) return null;

             const studentAttempts = DB_ATTEMPTS.filter(a => a.member_id == memberId);
             const preTest = DB_PRE_TESTS.find(p => p.member_id == memberId) || null;
             const postTest = DB_POST_TESTS.find(p => p.member_id == memberId) || null;

             const totalExp = Math.floor(Math.random() * 101) + 200; // Random EXP 200-300
             const level = 3;

             const completedMissions = [...new Set(studentAttempts.filter(a => a.pass).map(a => a.mission_id))];
             
             const denominator = preTest ? 10 - preTest.score : 0;
             const ds_value = (preTest && postTest && denominator > 0) ? ((postTest.score - preTest.score) / denominator * 100) : 0;
             
             return {
                 profile: { name: userProfile.full_name, class: userProfile.class },
                 stats: { level, exp: totalExp, ds: ds_value },
                 progress: { preTest, postTest, completedMissions }
             };
        }
        
        function getFullLeaderboardData() {
            return DB_MEMBERS
                .filter(m => m.role === 'student')
                .map(member => {
                    const preTest = DB_PRE_TESTS.find(p => p.member_id == member.member_id) || { score: 0 };
                    const postTest = DB_POST_TESTS.find(p => p.member_id == member.member_id) || { score: 0 };
                    const totalExp = Math.floor(Math.random() * 101) + 200;
                    const level = 3;
                    const denominator = 10 - preTest.score;
                    const ds_value = denominator > 0 ? ((postTest.score - preTest.score) / denominator * 100) : 0;

                    return {
                        name: member.nickname || member.full_name,
                        level,
                        ds_value,
                        ds: `${ds_value >= 0 ? '+' : ''}${ds_value.toFixed(2)}%`,
                        exp: totalExp
                    };
                })
                .sort((a, b) => {
                    if (b.level !== a.level) return b.level - a.level;
                    if (b.ds_value !== a.ds_value) return b.ds_value - a.ds_value;
                    return b.exp - a.exp;
                })
                .map((player, index) => ({ ...player, rank: index + 1 }));
        }


        function loadStudentData(memberId) {
            let studentData;
            
            if (memberId === 'demo') {
                 const preTest = {score: Math.floor(Math.random() * 5) + 1}; // Random pre-test 1-5
                 const postTest = {score: Math.floor(Math.random() * 4) + 6}; // Random post-test 6-9
                 let levelGroup = '‡∏≠‡πà‡∏≠‡∏ô';
                 if(preTest) {
                     if (preTest.score >= 7) levelGroup = '‡πÄ‡∏Å‡πà‡∏á';
                     else if (preTest.score >= 3) levelGroup = '‡∏Å‡∏•‡∏≤‡∏á';
                }
                studentData = {
                    profile: { name: currentUser.nickname, class: 'Demo Class' },
                    stats: { level: 3, exp: Math.floor(Math.random() * 101) + 200, exp_to_next: 300, coins: 1000, completedMissionsCount: 3, totalPlayTime: 15, accuracy: 85, levelGroup },
                    progress: { preTest, postTest, completedMissions: [1,2,3], badges: ['Maze Master', 'Power Collector'] }
                };
            } else {
                const userProfile = DB_MEMBERS.find(m => m.member_id == memberId);
                const studentAttempts = DB_ATTEMPTS.filter(a => a.member_id == memberId);
                const preTest = DB_PRE_TESTS.find(p => p.member_id == memberId) || null;
                const postTest = DB_POST_TESTS.find(p => p.member_id == memberId) || null;

                const totalExp = Math.floor(Math.random() * 101) + 200;
                const totalCoins = studentAttempts.reduce((sum, a) => sum + Number(a.coin_gained || 0), 1000);
                const level = 3; 
                const expInLevel = totalExp;

                const completedMissions = [...new Set(studentAttempts.filter(a => a.pass).map(a => a.mission_id))];
                const badges = [...new Set(studentAttempts.flatMap(a => (a.badges || '').split('|').filter(Boolean)))];
                const totalPlayTimeMinutes = Math.round(studentAttempts.reduce((sum, a) => sum + Number(a.time_total_sec || 0), 0) / 60);

                const totalCorrect = studentAttempts.reduce((sum, a) => sum + Number(a.correct || 0), 0);
                const totalQuestions = studentAttempts.length * 10;
                const accuracy = totalQuestions > 0 ? Math.round((totalCorrect / totalQuestions) * 100) : 0;
                
                let levelGroup = '‡∏≠‡πà‡∏≠‡∏ô';
                if(preTest && preTest.score) {
                    if (preTest.score >= 7) levelGroup = '‡πÄ‡∏Å‡πà‡∏á';
                    else if (preTest.score >= 3) levelGroup = '‡∏Å‡∏•‡∏≤‡∏á';
                }

                studentData = {
                    profile: { name: userProfile.nickname || userProfile.full_name, class: userProfile.class },
                    stats: { level, exp: expInLevel, exp_to_next: 300, coins: totalCoins, completedMissionsCount: completedMissions.length, totalPlayTime: totalPlayTimeMinutes, accuracy, levelGroup },
                    progress: { preTest, postTest, completedMissions, badges }
                };
            }
            currentUser.data = studentData; // Store processed data in current user
            updateStudentUI(studentData);
        }

        function loadTeacherData() {
            // Create a comprehensive student data array first
            const studentData = DB_MEMBERS
                .filter(m => m.role === 'student')
                .map(member => {
                    const preTest = DB_PRE_TESTS.find(p => p.member_id == member.member_id) || { score: 0 };
                    const postTest = DB_POST_TESTS.find(p => p.member_id == member.member_id) || { score: 0 };
                    const totalExp = Math.floor(Math.random() * 101) + 200; // Random EXP 200-300
                    const level = 3; // Keep level at 3 as per previous request
                    const denominator = 10 - preTest.score;
                    const ds_value = denominator > 0 ? ((postTest.score - preTest.score) / denominator * 100) : 0;

                    return {
                        member_id: member.member_id,
                        name: member.full_name,
                        nickname: member.nickname,
                        class: member.class,
                        level,
                        exp: totalExp,
                        pre: preTest.score,
                        post: postTest.score,
                        ds_value,
                        ds: `${ds_value >= 0 ? '+' : ''}${ds_value.toFixed(2)}%`
                    };
                });

            // Now use studentData for analytics
            const analytics = studentData;

            // And for leaderboard
            const leaderboard = [...studentData] // Create a copy for sorting
                .sort((a, b) => {
                    if (b.level !== a.level) return b.level - a.level;
                    if (b.ds_value !== a.ds_value) return b.ds_value - a.ds_value; // Use numeric value
                    return b.exp - a.exp;
                })
                .slice(0, 10)
                .map((player, index) => ({ ...player, rank: index + 1 }));

            updateTeacherUI({ analytics, leaderboard });
        }

        // --- UI Update Functions ---
        function updateStudentUI(data) {
             const resetBtn = document.getElementById('resetDemoDataBtn');
             if (resetBtn) {
                 if (currentUser && currentUser.member_id === 'demo') {
                     resetBtn.classList.remove('hidden');
                 } else {
                     resetBtn.classList.add('hidden');
                 }
             }

             const avatarEmoji = selectedAvatar === 'female' ? 'üë©‚Äçüéì' : 'üë®‚Äçüéì';
             const avatarClass = selectedAvatar === 'female' ? 'avatar-female' : 'avatar-male';
             
             document.querySelectorAll('#playerAvatar, #dashboardAvatar').forEach(el => {
                 el.textContent = avatarEmoji;
                 if (!el.className.includes(avatarClass)) {
                    el.className = el.className.replace(/avatar-(male|female)/g, '') + ` ${avatarClass}`;
                 }
             });

             // Update texts
             document.getElementById('playerName').textContent = data.profile.name;
             document.getElementById('playerClass').textContent = data.profile.class;
             document.getElementById('dashboardName').textContent = data.profile.name;
             document.getElementById('dashboardClass').textContent = data.profile.class;
             
             // Update stats
             ['playerLevel', 'dashboardLevel'].forEach(id => document.getElementById(id).textContent = data.stats.level);
             ['playerExp', 'dashboardExp'].forEach(id => document.getElementById(id).textContent = `${data.stats.exp}/${data.stats.exp_to_next}`);
             ['playerCoins', 'dashboardCoins'].forEach(id => document.getElementById(id).textContent = data.stats.coins.toLocaleString());
             document.getElementById('completedMissions').textContent = `${data.stats.completedMissionsCount}/3`;
             document.getElementById('totalPlayTime').textContent = `${data.stats.totalPlayTime} ‡∏ô‡∏≤‡∏ó‡∏µ`;
             document.getElementById('accuracy').textContent = `${data.stats.accuracy}%`;
             
             // Update Pre/Post Test Cards
             if(data.progress.preTest) {
                 document.getElementById('preTestContent').innerHTML = `<p class="text-gray-600 mb-2">‡∏ó‡∏≥‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß</p><p class="text-2xl font-bold text-blue-600">${data.progress.preTest.score}/10</p><p class="text-sm text-gray-500 mt-2">‡∏Å‡∏•‡∏∏‡πà‡∏°: ${data.stats.levelGroup}</p>`;
             }
             if(data.progress.postTest) {
                 document.getElementById('postTestContent').innerHTML = `<p class="text-gray-600 mb-2">‡∏ó‡∏≥‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß</p><p class="text-2xl font-bold text-green-600">${data.progress.postTest.score}/10</p>`;
             }
             
             // Unlock missions based on progress & set time limits
             const timeLimits = { '‡πÄ‡∏Å‡πà‡∏á': '1:30 ‡∏ô‡∏≤‡∏ó‡∏µ', '‡∏Å‡∏•‡∏≤‡∏á': '2:00 ‡∏ô‡∏≤‡∏ó‡∏µ', '‡∏≠‡πà‡∏≠‡∏ô': '2:30 ‡∏ô‡∏≤‡∏ó‡∏µ' };
             
             if (data.progress.preTest) {
                 document.getElementById('mission1Btn').textContent = 'üöÄ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à';
                 document.getElementById('mission1Btn').disabled = false;
                 document.getElementById('mission1Card').classList.remove('mission-locked');
                 document.getElementById('mission1TimeLimit').textContent = timeLimits[data.stats.levelGroup];

             }
             if (data.progress.completedMissions.includes(1)) {
                 document.getElementById('mission2Btn').textContent = 'üöÄ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à';
                 document.getElementById('mission2Btn').disabled = false;
                 document.getElementById('mission2Card').classList.remove('mission-locked');
                  document.getElementById('mission2TimeLimit').textContent = timeLimits[data.stats.levelGroup];
             }
             if (data.progress.completedMissions.includes(2)) {
                  document.getElementById('mission3Btn').textContent = 'üöÄ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à';
                 document.getElementById('mission3Btn').disabled = false;
                 document.getElementById('mission3Card').classList.remove('mission-locked');
                 document.getElementById('mission3TimeLimit').textContent = timeLimits[data.stats.levelGroup];
             }
             if (data.progress.completedMissions.length >= 3) {
                const postTestBtn = document.getElementById('postTestBtn');
                if (postTestBtn) {
                    postTestBtn.textContent = 'üöÄ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö';
                    postTestBtn.disabled = false;
                    postTestBtn.classList.remove('bg-gray-300', 'text-gray-500', 'cursor-not-allowed');
                    postTestBtn.classList.add('bg-green-500', 'hover:bg-green-600', 'text-white');
                }
             }

             initializeStudentCharts(data.progress.preTest, data.progress.postTest);
        }

        function updateTeacherUI(data) {
            document.getElementById('teacherTotalStudents').textContent = data.analytics.length;
            const avgScore = data.analytics.reduce((sum, s) => sum + s.post, 0) / data.analytics.length;
            document.getElementById('teacherAvgScore').textContent = `${avgScore.toFixed(1)}/10`;
            
            // Calculate and display average DS
            const totalDs = data.analytics.reduce((sum, s) => sum + s.ds_value, 0);
            const avgDs = data.analytics.length > 0 ? totalDs / data.analytics.length : 0;
            const avgDsText = `${avgDs >= 0 ? '+' : ''}${avgDs.toFixed(2)}%`;
            document.getElementById('teacherAvgDs').textContent = avgDsText;

            // Set Mission Completion
            document.getElementById('teacherMissionCompletion').textContent = '97%';

            populateLeaderboard('teacherLeaderboardContainer', data.leaderboard);
            populateStudentAnalytics(data.analytics);
            initializeTeacherCharts(data.analytics);
            populateClasses(MOCK_CLASSES);
        }

        // --- Test/Quiz Functions ---
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function generateTestQuestions() {
            const m1_q = shuffleArray(DB_QUESTIONS.filter(q => q.mission_id === 1)).slice(0, 4);
            const m2_q = shuffleArray(DB_QUESTIONS.filter(q => q.mission_id === 2)).slice(0, 3);
            const m3_q = shuffleArray(DB_QUESTIONS.filter(q => q.mission_id === 3)).slice(0, 3);
            return [...m1_q, ...m2_q, ...m3_q];
        }

        function startTest(type) {
             const testHistory = type === 'pre' ? DB_PRE_TESTS : DB_POST_TESTS;
             if (testHistory.some(t => t.member_id === currentUser.member_id)) {
                 showNotification('‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ô‡∏µ‡πâ‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß', 'warning');
                 return;
             }

            currentQuiz = {
                type: type,
                questions: generateTestQuestions(),
                answers: [],
                currentQuestionIndex: 0,
                score: 0
            };
            document.getElementById('quizTitle').textContent = type === 'pre' ? '‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô' : '‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô';
            displayQuestion();
            document.getElementById('quizModal').style.display = 'flex';
        }

        function displayQuestion() {
            const quizContent = document.getElementById('quizContent');
            const questionData = currentQuiz.questions[currentQuiz.currentQuestionIndex];
            const choices = shuffleArray([questionData.options[0], questionData.options[1], questionData.options[2], questionData.options[3]]);

            quizContent.innerHTML = `
                <h3 class="text-xl font-semibold mb-6">${questionData.question}</h3>
                <div class="space-y-3">
                    ${choices.map((choice, index) => `
                        <div class="quiz-option border-2 border-gray-300 rounded-lg p-3" onclick="selectAnswer(this, '${choice}')">
                            ${choice}
                        </div>
                    `).join('')}
                </div>
            `;
            document.getElementById('quizProgress').textContent = `‡∏Ç‡πâ‡∏≠ ${currentQuiz.currentQuestionIndex + 1} / ${currentQuiz.questions.length}`;
            
            const nextBtn = document.getElementById('nextQuestionBtn');
            if (currentQuiz.currentQuestionIndex === currentQuiz.questions.length - 1) {
                nextBtn.textContent = '‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö';
            } else {
                nextBtn.textContent = '‡∏Ç‡πâ‡∏≠‡∏ñ‡∏±‡∏î‡πÑ‡∏õ';
            }
        }

        function selectAnswer(element, answer) {
            document.querySelectorAll('.quiz-option').forEach(el => el.classList.remove('selected'));
            element.classList.add('selected');
            currentQuiz.answers[currentQuiz.currentQuestionIndex] = answer;
        }

        function nextQuestion() {
            if (currentQuiz.answers[currentQuiz.currentQuestionIndex] === undefined) {
                showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö', 'warning');
                return;
            }
            
            if (currentQuiz.currentQuestionIndex < currentQuiz.questions.length - 1) {
                currentQuiz.currentQuestionIndex++;
                displayQuestion();
            } else {
                submitTest();
            }
        }
        
        function submitTest() {
            let score = 0;
            for(let i=0; i < currentQuiz.questions.length; i++) {
                if(String(currentQuiz.answers[i]) === String(currentQuiz.questions[i].options[currentQuiz.questions[i].correct])) {
                    score++;
                }
            }
            currentQuiz.score = score;
            
            const db_target = currentQuiz.type === 'pre' ? DB_PRE_TESTS : DB_POST_TESTS;
            const existingRecord = db_target.find(r => r.member_id == currentUser.member_id);
            if (existingRecord) {
                existingRecord.score = score;
            } else {
                db_target.push({member_id: currentUser.member_id, score: score});
            }

            closeQuiz();
            
            // Show result modal
            const quizContent = document.getElementById('quizContent');
            quizContent.innerHTML = `
                <div class="text-center">
                    <h2 class="text-2xl font-bold mb-4">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö</h2>
                    <p class="text-lg mb-4">‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</p>
                    <p class="text-6xl font-bold text-purple-600 mb-6">${score}<span class="text-2xl text-gray-500">/10</span></p>
                    <button onclick="confirmTestResult()" class="bg-green-500 hover:bg-green-600 text-white px-6 py-2 rounded-lg">‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö‡∏ú‡∏•</button>
                </div>
            `;
            document.getElementById('quizModal').style.display = 'flex';
            document.getElementById('nextQuestionBtn').style.display = 'none';
        }
        
        function confirmTestResult() {
            closeQuiz();
            document.getElementById('nextQuestionBtn').style.display = 'block';
            showNotification(`‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß!`, 'success');
            loadStudentData(currentUser.member_id);
        }

        function closeQuiz() {
            document.getElementById('quizModal').style.display = 'none';
        }
        
        // --- Mission Functions ---
        function startMission(missionId) {
            // ... Logic to start mission ...
            showNotification(`‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏ó‡∏µ‡πà ${missionId}!`, 'info');
        }


        // --- Teacher Classroom Management ---
        function openCreateClassModal() {
            document.getElementById('createClassModal').style.display = 'flex';
        }

        function closeCreateClassModal() {
            document.getElementById('createClassModal').style.display = 'none';
            document.getElementById('createClassForm').reset();
        }

        document.getElementById('createClassForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const newClass = {
                name: document.getElementById('newClassName').value,
                subject: document.getElementById('newClassSubject').value,
                students: 0
            };
            MOCK_CLASSES.push(newClass);
            populateClasses(MOCK_CLASSES);
            closeCreateClassModal();
            showNotification(`‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô "${newClass.name}" ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß`, 'success');
        });
        
        function populateClasses(classes) {
            const container = document.getElementById('classListContainer');
            container.innerHTML = '';
            classes.forEach(c => {
                container.innerHTML += `
                    <div class="bg-white rounded-2xl shadow p-6 card-hover flex flex-col">
                        <h3 class="text-xl font-bold text-gray-800">${c.name}</h3>
                        <p class="text-sm text-purple-600 mb-2">${c.subject}</p>
                        <div class="flex-grow"></div>
                        <div class="flex justify-between items-center mt-4">
                             <span class="text-gray-500">üë• ${c.students} ‡∏Ñ‡∏ô</span>
                             <button class="bg-gray-200 hover:bg-gray-300 text-gray-800 px-4 py-2 rounded-lg font-semibold">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</button>
                        </div>
                    </div>
                `;
            });
        }
        
        // --- Populate dynamic content ---
        function populateLeaderboard(containerId, data) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            const rankClasses = ['leaderboard-gold', 'leaderboard-silver', 'leaderboard-bronze'];
            data.forEach(player => {
                const rankClass = player.rank <= 3 ? rankClasses[player.rank - 1] : 'bg-gray-100';
                const rankText = player.rank <= 3 ? 'text-white' : 'text-gray-800';
                const dsClass = player.ds_value >= 0 ? (player.rank <= 3 ? 'text-green-200' : 'text-green-600') : (player.rank <= 3 ? 'text-red-200' : 'text-red-600');
                container.innerHTML += `
                    <div class="flex items-center p-3 ${rankClass} rounded-lg text-sm">
                        <div class="w-8 h-8 flex items-center justify-center font-bold ${rankText} rounded-full mr-3 text-base">${player.rank}</div>
                        <div class="flex-grow ${rankText} font-semibold">${player.name}</div>
                        <div class="w-16 text-center ${rankText}"><span class="text-xs opacity-80">Lv.</span> ${player.level}</div>
                        <div class="w-24 text-center font-bold ${dsClass}">${player.ds}</div>
                        <div class="w-24 text-right ${rankText}"><span class="font-bold">${player.exp.toLocaleString()}</span> <span class="text-xs opacity-80">EXP</span></div>
                    </div>
                `;
            });
        }
        
        function populateStudentAnalytics(data) {
             const tableBody = document.getElementById('studentAnalyticsTable');
             tableBody.innerHTML = '';
             data.forEach(student => {
                 tableBody.innerHTML += `
                    <tr class="border-b hover:bg-gray-50">
                        <td class="p-3">${student.name}</td>
                        <td class="p-3">${student.class}</td>
                        <td class="p-3">${student.level}</td>
                        <td class="p-3">${student.pre}/10</td>
                        <td class="p-3">${student.post}/10</td>
                        <td class="p-3 font-bold ${student.ds.startsWith('+') ? 'text-green-600' : 'text-red-600'}">${student.ds}</td>
                    </tr>
                 `;
             });
        }

        // --- Notifications ---
        function showNotification(message, type = 'info') {
            const container = document.getElementById('notification-container');
            if(!container) return;
            const notif = document.createElement('div');
            notif.className = `notification ${type}`;
            notif.textContent = message;
            container.appendChild(notif);

            setTimeout(() => {
                notif.classList.add('show');
            }, 10);

            setTimeout(() => {
                notif.classList.remove('show');
                setTimeout(() => {
                    if (container.contains(notif)) {
                       container.removeChild(notif);
                    }
                }, 300);
            }, 3000);
        }

        // --- Chart.js Initializers ---
        let studentTestScoresChart, studentAccuracyByTopicChart, teacherStudentScoresChart;
        
        function showStudentDetailModal(memberId) {
            const studentFullData = getStudentDataById(memberId);
            
            const content = document.getElementById('studentDetailContent');
            if (!studentFullData) {
                content.innerHTML = '<p>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</p>';
                document.getElementById('studentDetailModal').style.display = 'flex';
                return;
            }
            
            const { profile, stats, progress } = studentFullData;
            const dsText = stats.ds ? `${stats.ds >= 0 ? '+' : ''}${stats.ds.toFixed(2)}%` : 'N/A';

            content.innerHTML = `
                <div class="flex items-center space-x-4 mb-4">
                     <div class="w-16 h-16 rounded-full flex items-center justify-center text-3xl flex-shrink-0 avatar-male text-white">üë®‚Äçüéì</div>
                     <div>
                        <h3 class="text-xl font-bold">${profile.name}</h3>
                        <p class="text-gray-500">${profile.class}</p>
                     </div>
                </div>
                <div class="grid grid-cols-2 gap-2 text-sm">
                    <p><strong>Level:</strong> ${stats.level}</p>
                    <p><strong>EXP:</strong> ${stats.exp}</p>
                    <p><strong>Pre-Test:</strong> ${progress.preTest ? progress.preTest.score : 'N/A'}/10</p>
                    <p><strong>Post-Test:</strong> ${progress.postTest ? progress.postTest.score : 'N/A'}/10</p>
                    <p class="col-span-2"><strong>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏Å‡∏≤‡∏£ (DS):</strong> <span class="font-bold ${stats.ds < 0 ? 'text-red-600' : 'text-green-600'}">${dsText}</span></p>
                    <p class="col-span-2"><strong>‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏ó‡∏µ‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:</strong> ${progress.completedMissions.length}/3</p>
                </div>
            `;
            document.getElementById('studentDetailModal').style.display = 'flex';
        }

        function closeStudentDetailModal() {
            document.getElementById('studentDetailModal').style.display = 'none';
        }
        
        function initializeStudentCharts(preTest, postTest) {
             if (studentTestScoresChart) studentTestScoresChart.destroy();
             studentTestScoresChart = new Chart(document.getElementById('studentTestScoresChart'), {
                type: 'bar',
                data: {
                    labels: ['Pre-test', 'Post-test'],
                    datasets: [{ label: '‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô', data: [preTest?.score || 0, postTest?.score || 0], backgroundColor: ['#60a5fa', '#10b981'] }]
                },
                options: { scales: { y: { beginAtZero: true, max: 10 } } }
            });

             if (studentAccuracyByTopicChart) studentAccuracyByTopicChart.destroy();
             studentAccuracyByTopicChart = new Chart(document.getElementById('studentAccuracyByTopicChart'), {
                type: 'radar',
                data: {
                    labels: ['‡∏ô‡∏¥‡∏¢‡∏≤‡∏°', '‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥', '‡∏™‡∏±‡∏ç‡∏Å‡∏£‡∏ì‡πå'],
                    datasets: [{ label: '‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥', data: [0, 0, 0], fill: true, backgroundColor: 'rgba(167, 139, 250, 0.2)', borderColor: '#8b5cf6', pointBackgroundColor: '#8b5cf6' }]
                },
                 options: { elements: { line: { borderWidth: 3 } }, scales: { r: { beginAtZero: true, max: 100 } } }
            });
        }
        
         function initializeTeacherCharts(analyticsData) {
            const passedCount = analyticsData.filter(s => s.post >= 5).length;
            const failedCount = analyticsData.length - passedCount;

            if (teacherStudentScoresChart) teacherStudentScoresChart.destroy();
            teacherStudentScoresChart = new Chart(document.getElementById('teacherStudentScoresChart'), {
                type: 'doughnut',
                data: {
                    labels: ['‡∏ú‡πà‡∏≤‡∏ô (‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 50%)', '‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô'],
                    datasets: [{
                        label: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô',
                        data: [passedCount, failedCount],
                        backgroundColor: ['#10b981', '#ef4444']
                    }]
                }
            });

            const helpList = document.getElementById('studentsToHelpList');
            helpList.innerHTML = '';
            const studentsToHelp = analyticsData.filter(s => s.ds_value < 0);
            if (studentsToHelp.length > 0) {
                studentsToHelp.forEach(s => {
                    helpList.innerHTML += `<li onclick="showStudentDetailModal(${s.member_id})" class="p-3 bg-red-100 rounded-lg text-red-800 cursor-pointer hover:bg-red-200 transition-colors flex justify-between items-center">
                        <span>${s.name}</span>
                        <span class="font-bold">${s.ds}</span>
                    </li>`;
                });
            } else {
                 helpList.innerHTML = `<li class="p-3 bg-green-100 rounded-lg text-green-800">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏û‡∏¥‡πÄ‡∏®‡∏©‡πÉ‡∏ô‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ ‡∏¢‡∏≠‡∏î‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°!</li>`;
            }
        }

        // --- Gemini API Function ---
        async function getAIHint() {
            const hintContainer = document.getElementById('aiHintContainer');
            const hintText = document.getElementById('aiHintText');
            const hintButton = document.getElementById('aiHintButton');

            hintContainer.style.display = 'block';
            hintText.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ç‡∏≠‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ‡∏à‡∏≤‡∏Å AI...';
            hintButton.disabled = true;

            const questionData = currentQuiz.questions[currentQuiz.currentQuestionIndex];
            const incorrectAnswer = currentQuiz.answers[currentQuiz.currentQuestionIndex];

            const systemPrompt = "You are a helpful math tutor for a middle school student. Your role is to provide a short, simple hint in Thai to guide them to the correct thinking process without giving away the direct answer or the final calculation.";
            const userQuery = `‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥‡πÇ‡∏à‡∏ó‡∏¢‡πå‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏•‡∏Ç‡∏¢‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á ‡πÇ‡∏à‡∏ó‡∏¢‡πå‡∏Ñ‡∏∑‡∏≠: "${questionData.question}" ‡πÄ‡∏Ç‡∏≤‡∏ï‡∏≠‡∏ö‡∏ú‡∏¥‡∏î‡πÇ‡∏î‡∏¢‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö "${incorrectAnswer}" ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ñ‡∏∑‡∏≠ "${questionData.answer}" ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏´‡πâ‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ‡∏™‡∏±‡πâ‡∏ô‡πÜ ‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ä‡∏µ‡πâ‡πÅ‡∏ô‡∏∞‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏â‡∏•‡∏¢‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á`;

            try {
                const payload = {
                    contents: [{ parts: [{ text: userQuery }] }],
                    systemInstruction: {
                        parts: [{ text: systemPrompt }]
                    },
                };

                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                
                if (!response.ok) {
                   throw new Error(`API request failed with status ${response.status}`);
                }

                const result = await response.json();
                const candidate = result.candidates?.[0];

                if (candidate && candidate.content?.parts?.[0]?.text) {
                    hintText.textContent = candidate.content.parts[0].text;
                } else {
                    hintText.textContent = '‡∏Ç‡∏≠‡∏≠‡∏†‡∏±‡∏¢, ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ';
                }
            } catch (error) {
                console.error('Gemini API Error:', error);
                hintText.textContent = '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö AI';
            } finally {
                hintButton.style.display = 'none'; // Hide button after use
            }
        }
        
        // --- Initial State ---
        document.addEventListener('DOMContentLoaded', () => {
            showScreen('loginScreen');
        });
    </script>
</body>
</html>

